import{H as p,J as N,r as U,c as f,b as c,i as _,d,e as r,g as x,q as E,t as s,j as T,A as y,n as L,N as S}from"./vue-vendor-wiowK_YT.js";import{_ as B,C as F}from"./account-CYVf-4X6.js";const V={name:"EventCard",components:{CalendarIcon:F,ClockIcon:N,MapPinIcon:p},props:{event:{type:Object,required:!0}},setup(n){const a=S(),i=U(!1),t=f(()=>{if(i.value)return null;let e=n.event.image||n.event.image_url||n.event.image_file;if(console.log("EventCard - Image URL pour:",n.event.title,"Image:",e),!e||e.trim()==="")return console.log("EventCard - Aucune image trouvée"),null;if(e.startsWith("http://")||e.startsWith("https://"))return console.log("EventCard - URL complète détectée:",e),e;if(e.startsWith("/")){const o=window.location.origin+e;return console.log("EventCard - Chemin relatif converti:",o),o}if(!e.includes("/")){const o=`${window.location.origin}/storage/images/events/${e}`;return console.log("EventCard - Nom de fichier converti:",o),o}return console.log("EventCard - URL retournée telle quelle:",e),e}),b=f(()=>{let e=null;if(n.event.schedules&&n.event.schedules.length>0&&(e=n.event.schedules[0].starts_at),!e&&n.event.next_schedule&&(e=n.event.next_schedule.starts_at),!e)return null;try{let o;if(e.includes("T")||e.includes("Z"))o=new Date(e);else if(e.includes("/")){const[m,v]=e.split(" "),[u,w,C]=m.split("/");o=new Date(`${C}-${w.padStart(2,"0")}-${u.padStart(2,"0")}T${v||"00:00:00"}`)}else if(e.includes("-")){const m=e.replace(" ","T");o=new Date(m)}else o=new Date(e);return isNaN(o.getTime())?(console.warn("Date invalide pour l'événement:",n.event.title,"Date reçue:",e),null):o}catch(o){return console.error("Erreur lors du parsing de la date:",o,"Date reçue:",e),null}}),I=f(()=>{if(n.event.min_price!==void 0&&n.event.min_price!==null&&n.event.min_price>0)return n.event.min_price;const e=n.event.ticket_types||n.event.ticketTypes;if(e&&e.length>0){const o=e.map(m=>{const v=parseFloat(m.price);return isNaN(v)?0:v}).filter(m=>m>0);if(o.length>0)return Math.min(...o)}return 0}),g=f(()=>b.value?new Date>b.value:!1),h=f(()=>{if(g.value)return 0;const e=n.event.ticket_types||n.event.ticketTypes;if(e&&e.length>0){const o=e.reduce((v,u)=>{if(u.remaining_quantity!==void 0&&u.remaining_quantity!==null)return v+Math.max(0,u.remaining_quantity);if(u.available_quantity!==void 0&&u.available_quantity!==null){const z=u.sold_quantity||0;return v+Math.max(0,u.available_quantity-z)}const w=u.quantity||0,C=u.sold_quantity||u.sold||0;return v+Math.max(0,w-C)},0);return e.some(v=>v.available_quantity!==null&&v.available_quantity!==void 0)?o:1e3}return 1e3}),k=f(()=>g.value?"Événement passé":h.value===0?"Complet":"Acheter un ticket"),l=f(()=>!g.value&&h.value>0),D=e=>e?e.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"Date à confirmer",q=e=>e?e.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"--:--",M=e=>new Intl.NumberFormat("fr-FR").format(e),j=(e,o)=>!e||typeof e!="string"?"":e.length<=o?e:e.substr(0,o).trim()+"...",R=()=>{a.push(`/events/${n.event.slug}`)},P=()=>{console.log("goToCheckout called with event:",n.event),console.log("Event slug:",n.event.slug);let e=n.event.slug;if(!e)if(n.event.id)e={1:"concert-jazz-etoiles",2:"oiseau-rare",3:"festival-arts-culture"}[n.event.id]||`event-${n.event.id}`;else if(n.event.title)e=n.event.title.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-").slice(0,50);else{console.error("Event slug, ID and title are all missing!",n.event),alert("Erreur: Impossible de réserver - informations manquantes");return}console.log("Using slug:",e),a.push(`/checkout/${e}`)};return{eventImageUrl:t,eventDate:b,minPrice:I,isEventPassed:g,availableTickets:h,buttonText:k,canPurchase:l,formatDate:D,formatTime:q,formatPrice:M,truncateText:j,goToEvent:R,goToCheckout:P,handleReserveClick:e=>{if(console.log("handleReserveClick called"),e.preventDefault(),e.stopPropagation(),!l.value){console.log("Cannot purchase - button disabled");return}P()},handleImageError:e=>{console.warn("EventCard - Erreur de chargement image pour:",n.event.title),console.warn("EventCard - URL qui a échoué:",e?.target?.src),i.value=!0}}}},A={class:"event-image"},W=["src","alt"],H={key:1,class:"w-full h-full bg-gradient-to-br from-blue-100 to-yellow-100 flex items-center justify-center"},Q={key:2,class:"absolute top-4 left-4"},G={class:"bg-yellow-400 primea-text-blue px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide"},J={class:"absolute bottom-4 left-4 right-4 flex items-end justify-between"},O={class:"bg-black/70 backdrop-blur-sm rounded-lg px-3 py-2 text-white"},Z={key:0},K={class:"text-lg font-bold"},X={key:1,class:"text-lg font-bold text-green-400"},Y={class:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center pointer-events-none"},$={class:"p-6"},ee={class:"flex flex-wrap items-center gap-2 md:gap-4 mb-3 text-sm text-gray-500"},te={class:"flex items-center gap-1 whitespace-nowrap"},ne={class:"flex items-center gap-1 whitespace-nowrap"},re={class:"font-bold text-xl primea-text-blue mb-2 line-clamp-2"},ae={class:"flex items-center gap-1 mb-3 text-gray-600"},oe={key:0},ie={key:1},le={key:2},se={class:"text-gray-600 text-sm mb-4 line-clamp-3"},ce={class:"flex items-center justify-between"},de={key:0,class:"text-gray-500 text-sm font-medium flex items-center gap-1"},ue={key:1,class:"text-amber-600 text-sm font-medium flex items-center gap-1"},ve={key:2,class:"text-red-600 text-sm font-medium"},me=["disabled"];function ge(n,a,i,t,b,I){const g=E("CalendarIcon"),h=E("ClockIcon"),k=E("MapPinIcon");return i.event&&i.event.title?(d(),c("article",{key:0,class:"event-card-modern group cursor-pointer",onClick:a[5]||(a[5]=(...l)=>t.goToEvent&&t.goToEvent(...l))},[r("div",A,[t.eventImageUrl?(d(),c("img",{key:0,src:t.eventImageUrl,alt:i.event.title,loading:"lazy",class:"w-full h-full object-cover",onError:a[0]||(a[0]=(...l)=>t.handleImageError&&t.handleImageError(...l))},null,40,W)):(d(),c("div",H,[x(g,{size:"2xl",class:"primea-text-gray-400"})])),i.event.category?.name||i.event.category_name?(d(),c("div",Q,[r("span",G,s(i.event.category?.name||i.event.category_name||"Événement"),1)])):_("",!0),r("div",J,[r("div",O,[t.minPrice>0?(d(),c("div",Z,[a[6]||(a[6]=r("div",{class:"text-xs text-gray-300"},"À partir de",-1)),r("div",K,s(t.formatPrice(t.minPrice))+" FCFA",1)])):(d(),c("div",X,"Gratuit"))]),t.canPurchase?(d(),c("button",{key:0,onClick:a[1]||(a[1]=T((...l)=>t.goToCheckout&&t.goToCheckout(...l),["stop"])),class:"ticket-btn-animate bg-yellow-500 text-blue-950 px-4 py-2 rounded-lg text-sm font-bold hover:bg-yellow-400 transition-all flex items-center gap-1 shadow-lg hover:shadow-xl"},[...a[7]||(a[7]=[r("svg",{class:"w-4 h-4 ticket-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})],-1),y(" Prendre un ticket ",-1)])])):_("",!0)]),r("div",Y,[r("button",{onClick:a[2]||(a[2]=T((...l)=>t.goToEvent&&t.goToEvent(...l),["stop"])),class:"bg-primea-yellow text-primea-blue px-6 py-3 rounded-primea-lg font-bold hover:bg-white hover:text-primea-blue transition-all duration-200 shadow-primea-lg transform translate-y-4 group-hover:translate-y-0 flex items-center pointer-events-auto"},[...a[8]||(a[8]=[r("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),y(" Voir détails ",-1)])])])]),r("div",$,[r("div",ee,[r("div",te,[x(g,{size:"sm"}),r("span",null,s(t.formatDate(t.eventDate)),1)]),r("div",ne,[x(h,{class:"w-4 h-4"}),r("span",null,s(t.formatTime(t.eventDate)),1)])]),r("h3",re,[r("button",{onClick:a[3]||(a[3]=(...l)=>t.goToEvent&&t.goToEvent(...l)),class:"hover:underline text-left"},s(i.event.title),1)]),r("div",ae,[x(k,{class:"w-4 h-4"}),i.event.venue?(d(),c("span",oe,s(i.event.venue.name)+", "+s(i.event.venue.city),1)):i.event.venue_name?(d(),c("span",ie,s(i.event.venue_name)+", "+s(i.event.venue_city),1)):(d(),c("span",le,"Lieu à confirmer"))]),r("p",se,s(t.truncateText(i.event.description,120)),1),r("div",ce,[r("div",null,[t.isEventPassed?(d(),c("div",de,[...a[9]||(a[9]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),y(" Événement terminé ",-1)])])):t.availableTickets<20&&t.availableTickets>0?(d(),c("div",ue,[a[10]||(a[10]=r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),y(" "+s(t.availableTickets)+" place"+s(t.availableTickets>1?"s":"")+" restante"+s(t.availableTickets>1?"s":""),1)])):t.availableTickets===0&&!t.isEventPassed?(d(),c("div",ve,"Complet")):_("",!0)]),r("button",{onClick:a[4]||(a[4]=T((...l)=>t.handleReserveClick&&t.handleReserveClick(...l),["stop"])),class:L(["px-6 py-2 rounded-primea text-sm font-bold transition-all duration-200 font-primea shadow-primea border-2",t.canPurchase?"ticket-btn-animate bg-primea-blue text-white hover:bg-primea-yellow hover:text-primea-blue transform hover:scale-105 border-primea-blue hover:border-primea-yellow":t.isEventPassed?"bg-gray-400 text-white cursor-not-allowed border-gray-400":"bg-red-500 text-white cursor-not-allowed border-red-500"]),disabled:!t.canPurchase},s(t.buttonText),11,me)])])])):_("",!0)}const xe=B(V,[["render",ge],["__scopeId","data-v-aad605fa"]]);export{xe as E};
