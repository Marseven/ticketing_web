import{ar as ke,aw as Se,aA as Pe,J as Ee,H as Ce,Z as Ie,D as Me,g as l,o as i,h as o,l as b,j as g,a as _,t as d,k as oe,A as I,p as Ne,i as U,v as K,L as Te,F as qe,q as Fe,n as H,$ as Ve,U as re,b as v,d as h,e as Ae,f as De,B as Ue,N as je}from"./vue-vendor-DkyC1Igy.js";import{u as Re}from"./app-BjiB006s.js";import{_ as Oe,P as Le,g as ae}from"./account-BPl4L88c.js";import"./vendor-BvANJOFB.js";/* empty css            */import"./pinia-vendor-T35r7xXn.js";const Be={name:"Checkout",components:{PhoneInput:Le,ExclamationCircleIcon:Me,PhotoIcon:Ie,MapPinIcon:Ce,ClockIcon:Ee,ArrowTopRightOnSquareIcon:Pe,ChevronLeftIcon:Se,Bars3Icon:ke},setup(){const j=Ue(),t=je(),X=Re(),e=v(null),T=v(!0),q=v(""),f=v(!1),x=v(""),k=v(""),S=v(null),M=v(new Date),F=v({days:0,hours:0,minutes:0,seconds:0}),V=v(!1),P=v(90),y=v(null),a=v(null),C=v(""),p=v(null),n=v({quantity:1,ticketTypeId:"",paymentMethod:"",phoneNumber:"",cardNumber:"",expiryDate:"",cvv:"",guestName:"",guestPhone:""}),G=v(!1),ne=h(()=>{if(G.value||!e.value)return null;let r=e.value.image||e.value.image_url||e.value.image_file;return console.log("Checkout - Image URL:",r),!r||r.trim()===""?null:r.startsWith("http://")||r.startsWith("https://")?r:r.startsWith("/")?window.location.origin+r:r.includes("/")?r:`${window.location.origin}/storage/images/events/${r}`}),se=h(()=>!e.value?.schedules||e.value.schedules.length===0?"Date à confirmer":new Date(e.value.schedules[0].starts_at).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}).toUpperCase()),le=h(()=>!e.value?.schedules||e.value.schedules.length===0?"Heure à confirmer":new Date(e.value.schedules[0].starts_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})),A=h(()=>!e.value?.schedules||e.value.schedules.length===0?null:new Date(e.value.schedules[0].starts_at)),D=h(()=>A.value?new Date>A.value:!1),R=h(()=>{if(!A.value)return null;const r=A.value.getTime()-M.value.getTime();if(r<=0)return{days:0,hours:0,minutes:0,seconds:0,expired:!0};const s=Math.floor(r/(1e3*60*60*24)),u=Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),c=Math.floor(r%(1e3*60*60)/(1e3*60)),w=Math.floor(r%(1e3*60)/1e3);return{days:s,hours:u,minutes:c,seconds:w,expired:!1}}),O=h(()=>!e.value?.ticket_types||D.value?[]:e.value.ticket_types.filter(r=>{if(r.remaining_quantity!==void 0&&r.remaining_quantity!==null)return r.remaining_quantity>0;if(r.available_quantity!==void 0&&r.available_quantity!==null){const s=r.sold_quantity||0;return r.available_quantity-s>0}return r.available_quantity===null?!0:r.quantity-(r.sold||0)>0})),ie=h(()=>!D.value&&O.value.length>0),N=h(()=>{if(!n.value.quantity||!n.value.ticketTypeId)return 0;const r=O.value.find(s=>s.id==n.value.ticketTypeId);return r?r.price*n.value.quantity:0}),L=h(()=>!n.value.quantity||!n.value.ticketTypeId||!n.value.paymentMethod||!n.value.guestName?!1:n.value.paymentMethod==="airtel"||n.value.paymentMethod==="moov"?!!n.value.phoneNumber&&!k.value:(n.value.paymentMethod==="visa",!0)),Q=r=>new Intl.NumberFormat("fr-FR").format(r),de=r=>{if(r.remaining_quantity!==void 0&&r.remaining_quantity!==null)return r.remaining_quantity>0?`${r.remaining_quantity} disponibles`:"Épuisé";if(r.available_quantity===null)return"Illimité";if(r.available_quantity!==void 0&&r.available_quantity!==null){const u=r.available_quantity-(r.sold_quantity||0);return u>0?`${u} disponibles`:"Épuisé"}const s=r.quantity-(r.sold||0);return s>0?`${s} disponibles`:"Épuisé"},ue=()=>e.value?e.value.category&&typeof e.value.category=="object"&&e.value.category.name?e.value.category.name.toUpperCase():e.value.category&&typeof e.value.category=="string"?e.value.category.toUpperCase():e.value.category_name&&typeof e.value.category_name=="string"?e.value.category_name.toUpperCase():"ÉVÉNEMENT":"ÉVÉNEMENT",Z=async()=>{const r=j.params.eventSlug;if(!r){q.value="ID d'événement manquant",T.value=!1;return}try{T.value=!0,q.value="";const s=await X.fetchEvent(r);e.value=s.event,e.value?.ticket_types&&e.value.ticket_types.length===1&&(n.value.ticketTypeId=e.value.ticket_types[0].id),ce()}catch(s){q.value=s.message||"Erreur lors du chargement de l'événement"}finally{T.value=!1}},Y=()=>{const r=R.value;r?(F.value={days:r.days,hours:r.hours,minutes:r.minutes,seconds:r.seconds},console.log("Checkout - Countdown updated:",F.value)):console.log("Checkout - timeUntilEvent is null")},ce=()=>{S.value&&clearInterval(S.value),M.value=new Date,Y(),S.value=setInterval(()=>{M.value=new Date,Y(),R.value?.expired&&clearInterval(S.value)},1e3),console.log("Checkout - Compte à rebours démarré")},me=()=>{const r=n.value.phoneNumber,s=n.value.paymentMethod;if(k.value="",!!r){if(s==="airtel"){const u=["074","076","077"];r.length===9&&/^[0-9]+$/.test(r)&&u.some(w=>r.startsWith(w))||(k.value="Le numéro Airtel Money doit faire 9 chiffres et commencer par 074, 076 ou 077")}if(s==="moov"){const u=["060","062","065","066"];r.length===9&&/^[0-9]+$/.test(r)&&u.some(w=>r.startsWith(w))||(k.value="Le numéro Moov Money doit faire 9 chiffres et commencer par 060, 062, 065 ou 066")}}},ve=r=>{n.value.paymentMethod=r,n.value.phoneNumber="",n.value.cardNumber="",n.value.expiryDate="",n.value.cvv="",k.value=""},pe=()=>{if(!L.value){x.value="Veuillez remplir tous les champs requis avant de procéder au paiement";return}const r={eventSlug:j.params.eventSlug,eventTitle:e.value?.title,quantity:n.value.quantity,ticketTypeId:n.value.ticketTypeId,amount:N.value,currency:"XAF",returnUrl:`${window.location.origin}/checkout/success`,cancelUrl:`${window.location.origin}/checkout/cancel`};console.log("Redirection vers paiement Visa avec:",r),""+new URLSearchParams(r).toString(),alert(`Redirection vers le paiement Visa sécurisé...
Montant: ${Q(N.value)} FCFA
Événement: ${e.value?.title}`)},be=async()=>{try{if(f.value=!0,x.value="",D.value)throw new Error("Impossible d'acheter des tickets pour un événement terminé");if(!L.value)throw new Error("Veuillez remplir tous les champs requis");if(n.value.paymentMethod==="airtel"||n.value.paymentMethod==="moov")await $();else if(n.value.paymentMethod==="visa")await ee();else throw new Error("Méthode de paiement non supportée")}catch(r){if(console.error("Erreur lors du processus d'achat:",r),r.response?.data?.message)x.value=r.response.data.message;else if(r.response?.data?.errors){const s=r.response.data.errors,u=[];for(const[c,w]of Object.entries(s)){const m={guest_name:"Nom complet",guest_email:"Email",guest_phone:"Téléphone",ticket_type_id:"Type de ticket",quantity:"Quantité",phone:"Numéro de téléphone",amount:"Montant"}[c]||c;w.forEach(J=>{J==="validation.required"?u.push(`Le champ ${m} est requis`):u.push(J)})}x.value=u.join(". ")}else x.value=r.message||"Erreur lors du traitement de l'achat"}finally{f.value=!1}},$=async()=>{try{const r={event_slug:e.value.slug,ticket_type_id:n.value.ticketTypeId,quantity:n.value.quantity,guest_name:n.value.guestName,guest_phone:n.value.guestPhone||null,guest_email:"guest@primea.ga"},s=await ae.createGuestOrder(r);if(!s.data.success)throw new Error(s.data.message||"Erreur lors de la création de l'achat");const u=s.data.data.order,c={order_id:u.id,gateway:n.value.paymentMethod==="airtel"?"airtelmoney":"moovmoney",phone:n.value.phoneNumber,amount:N.value},m=await(await fetch("/api/v1/payments/initiate",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify(c)})).json();if(!m.success)throw new Error(m.message||"Erreur lors de l'initiation du paiement");if(m.data?.bill_id){const E=await(await fetch("/api/v1/payments/push-ussd",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify({payment_id:m.data.payment.id,bill_id:m.data.bill_id,phone:n.value.phoneNumber,gateway:n.value.paymentMethod==="airtel"?"airtelmoney":"moovmoney"})})).json();if(E.success)te({payment_id:m.data.payment.id,reference:u.reference,phone:n.value.phoneNumber,gateway:n.value.paymentMethod==="airtel"?"airtelmoney":"moovmoney",amount:N.value,bill_id:m.data.bill_id,payment_url:m.data.payment_url});else{console.error("❌ Push USSD échoué:",{message:E.message,error_code:E.error_code,details:E.details,payment_id:m.data.payment.id,bill_id:m.data.bill_id,phone:n.value.phoneNumber,gateway:n.value.paymentMethod});const _e=E.details?`${E.message}
Détails: ${E.details}`:E.message||"Erreur lors de l'envoi du push USSD";throw new Error(_e)}}else throw new Error("Erreur lors de la création de la facture E-Billing")}catch(r){throw console.error("Erreur E-Billing:",r),r}},ee=async()=>{try{const r={event_slug:e.value.slug,ticket_type_id:n.value.ticketTypeId,quantity:n.value.quantity,guest_name:n.value.guestName,guest_phone:n.value.guestPhone||null,guest_email:"guest@primea.ga"},s=await ae.createGuestOrder(r);if(!s.data.success)throw new Error(s.data.message||"Erreur lors de la création de l'achat");const c={order_id:s.data.data.order.id,gateway:"ORABANK_NG",amount:N.value},m=await(await fetch("/api/v1/payments/initiate",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify(c)})).json();if(m.success&&m.data?.redirect_url)window.location.href=m.data.redirect_url;else throw new Error(m.message||"Erreur lors de l'initiation du paiement Visa/Mastercard")}catch(r){throw console.error("Erreur ORABANK:",r),r}},ye=()=>{t.back()},te=r=>{V.value=!0,P.value=90,C.value="pending",p.value=r,B(),z(r.payment_id)},B=()=>{y.value&&clearInterval(y.value),y.value=setInterval(()=>{P.value--,P.value<=0&&(clearInterval(y.value),clearInterval(a.value),C.value="expired")},1e3)},z=r=>{a.value&&clearInterval(a.value),a.value=setInterval(async()=>{try{const s=await fetch(`/api/payments/${r}/status`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(s.ok){const c=(await s.json()).data?.payment?.status;c==="success"||c==="successful"?(C.value="successful",clearInterval(a.value),clearInterval(y.value),setTimeout(()=>{t.push(`/ticket-success?reference=${p.value.reference}`)},2e3)):(c==="failed"||c==="cancelled"||c==="expired")&&(C.value=c,clearInterval(a.value),clearInterval(y.value),setTimeout(()=>{W()},3e3))}}catch(s){console.error("Erreur lors de la vérification du statut:",s)}},3e3)},W=()=>{V.value=!1,P.value=90,C.value="",p.value=null,y.value&&clearInterval(y.value),a.value&&clearInterval(a.value)},ge=async()=>{if(p.value)try{f.value=!0;const r=await fetch("/api/payments/push-ussd",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify({payment_id:p.value.payment_id,phone:p.value.phone,gateway:p.value.gateway})});if(r.ok)P.value=90,C.value="pending",B(),z(p.value.payment_id);else{const s=await r.json();x.value=s.message||"Erreur lors du renvoi du push"}}catch{x.value="Erreur de connexion"}finally{f.value=!1}},xe=()=>{if(!p.value?.payment_url||!p.value?.bill_id){console.error("URL de paiement manquante");return}const r=`${p.value.payment_url}?invoice=${p.value.bill_id}`;window.location.href=r},he=()=>{W(),n.value.paymentMethod="",n.value.phoneNumber=""},fe=r=>{const s=Math.floor(r/60),u=r%60;return`${s}:${u.toString().padStart(2,"0")}`},we=r=>r?r.replace(/(\d{3})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4"):"";return Ae(()=>{Z()}),De(()=>{S.value&&clearInterval(S.value),y.value&&clearInterval(y.value),a.value&&clearInterval(a.value)}),{event:e,eventLoading:T,eventError:q,loading:f,error:x,phoneError:k,countdown:F,orderForm:n,totalAmount:N,isFormValid:L,formatEventDate:se,eventTime:le,eventDate:A,isEventPassed:D,timeUntilEvent:R,availableTicketTypes:O,canPurchaseTickets:ie,formatPrice:Q,getAvailableQuantityText:de,getCategoryName:ue,loadEvent:Z,validatePhoneNumber:me,selectPaymentMethod:ve,redirectToVisaPayment:pe,processOrder:be,goBack:ye,ussdPushActive:V,ussdCountdown:P,paymentStatus:C,currentPayment:p,startUSSDPush:te,startUSSDCountdown:B,startPaymentPolling:z,cancelUSSDPush:W,retryUSSDPush:ge,payViaWebPage:xe,changeOperator:he,formatCountdown:fe,formatPhoneForDisplay:we,processEBillingPayment:$,processOrabankPayment:ee,eventImageUrl:ne,handleImageError:()=>{console.warn("Checkout - Erreur de chargement de l'image"),G.value=!0}}}},ze={class:"checkout-page min-h-screen font-primea"},We={class:"hidden md:block bg-gray-50 min-h-screen"},Je={class:"container mx-auto px-4 py-12"},Ke={class:"max-w-4xl mx-auto"},He={key:0,class:"text-center py-8"},Xe={key:1,class:"text-center py-8"},Ge={class:"bg-red-50 border border-red-200 rounded-primea-xl p-8"},Qe={class:"text-red-600 mb-4"},Ze={key:2,class:"grid grid-cols-1 lg:grid-cols-2 gap-12"},Ye={class:"space-y-8"},$e={class:"bg-white rounded-primea-xl shadow-primea overflow-hidden"},et={class:"relative h-64"},tt=["src","alt"],ot={key:1,class:"w-full h-full bg-primea-gradient flex items-center justify-center"},rt={class:"absolute inset-0 p-6 text-white flex flex-col justify-end"},at={class:"bg-primea-yellow text-primea-blue px-3 py-1 rounded-primea text-sm font-bold w-fit mb-2"},nt={class:"text-2xl font-bold mb-2"},st={class:"text-white/90"},lt={class:"p-6"},it={class:"space-y-3"},dt={class:"flex items-center gap-3"},ut={class:"text-gray-700"},ct={class:"flex items-center gap-3"},mt={class:"text-gray-700"},vt={class:"bg-white rounded-primea-xl shadow-primea p-6"},pt={class:"text-lg font-bold text-primea-blue mb-4 text-center"},bt={key:0,class:"text-center"},yt={class:"bg-red-50 border border-red-200 rounded-primea-lg p-4"},gt={key:1,class:"flex justify-center space-x-2"},xt={key:0,class:"text-center bg-gray-100 border-2 border-primea-blue rounded-primea-lg p-4 min-w-[70px]"},ht={class:"text-2xl font-bold text-primea-blue"},ft={class:"text-center bg-gray-100 border-2 border-primea-blue rounded-primea-lg p-4 min-w-[70px]"},wt={class:"text-2xl font-bold text-primea-blue"},_t={class:"text-center bg-gray-100 border-2 border-primea-blue rounded-primea-lg p-4 min-w-[70px]"},kt={class:"text-2xl font-bold text-primea-blue"},St={class:"text-center bg-gray-100 border-2 border-primea-blue rounded-primea-lg p-4 min-w-[70px]"},Pt={class:"text-2xl font-bold text-primea-blue"},Et={class:"bg-white rounded-primea-xl shadow-primea p-8"},Ct={class:"text-2xl font-bold text-primea-blue mb-6"},It={key:0,class:"bg-red-50 border border-red-200 rounded-primea-lg p-6 text-center"},Mt=["disabled"],Nt=["value"],Tt={key:0,class:"text-sm text-red-600 mt-1"},qt={class:"bg-primea-blue/5 rounded-primea-xl p-6 space-y-4"},Ft={key:0,class:"bg-primea-blue/5 rounded-primea-xl p-6"},Vt={class:"flex justify-between items-center"},At={class:"text-3xl font-bold text-primea-blue"},Dt={class:"grid grid-cols-3 gap-4 mb-6"},Ut={key:0},jt=["for"],Rt=["id","placeholder"],Ot={key:0,class:"mt-2 text-sm text-red-600"},Lt={key:1,class:"mt-2 text-sm text-gray-500"},Bt={key:1,class:"space-y-4"},zt={class:"bg-blue-50 border border-blue-200 rounded-primea-lg p-4 text-center"},Wt={key:1,class:"bg-red-50 border-2 border-red-200 rounded-primea-lg p-4"},Jt={class:"text-red-600 text-sm"},Kt={key:2,class:"bg-blue-50 border-2 border-blue-200 rounded-primea-xl p-6"},Ht={class:"text-center"},Xt={key:0,class:"space-y-4"},Gt={class:"text-blue-700 mb-4"},Qt={class:"font-semibold"},Zt={class:"bg-white border border-blue-200 rounded-primea-lg p-4 mb-4"},Yt={class:"text-3xl font-bold text-blue-600 mb-2"},$t={class:"w-full bg-blue-200 rounded-full h-2 mt-3"},eo={class:"text-blue-600 text-sm mb-4"},to={class:"font-semibold"},oo={class:"flex flex-col sm:flex-row gap-3 justify-center"},ro=["disabled"],ao={key:0},no={key:1},so=["disabled"],lo={key:1,class:"space-y-4"},io={key:2,class:"space-y-4"},uo={class:"text-red-700 mb-4"},co={class:"flex flex-col sm:flex-row gap-3 justify-center"},mo=["disabled"],vo={key:0,class:"flex items-center justify-center"},po={key:1},bo={class:"text-center pt-4"},yo={class:"md:hidden bg-gray-100 min-h-screen py-8 px-4"},go={class:"max-w-md mx-auto"},xo={class:"flex items-center justify-between mb-8"},ho={class:"text-gray-600"};function fo(j,t,X,e,T,q){const f=_("ExclamationCircleIcon"),x=_("PhotoIcon"),k=_("MapPinIcon"),S=_("ClockIcon"),M=_("router-link"),F=_("PhoneInput"),V=_("ArrowTopRightOnSquareIcon"),P=_("ChevronLeftIcon"),y=_("Bars3Icon");return i(),l("div",ze,[o("div",We,[o("div",Je,[o("div",Ke,[t[59]||(t[59]=o("div",{class:"text-center mb-12"},[o("img",{src:"/images/logo.png",alt:"Primea",class:"h-16 mx-auto mb-6"}),o("h1",{class:"text-4xl font-bold text-primea-blue mb-4"},"Finaliser votre achat"),o("p",{class:"text-lg text-gray-600"},"Sélectionnez vos tickets et procédez au paiement")],-1)),e.eventLoading?(i(),l("div",He,[...t[20]||(t[20]=[o("div",{class:"animate-spin rounded-full h-32 w-32 border-b-2 border-primea-blue mx-auto"},null,-1),o("p",{class:"mt-4 text-gray-600"},"Chargement de l'événement...",-1)])])):e.eventError?(i(),l("div",Xe,[o("div",Ge,[g(f,{class:"w-16 h-16 text-red-500 mx-auto mb-4"}),t[21]||(t[21]=o("h3",{class:"text-lg font-semibold text-red-800 mb-2"},"Erreur de chargement",-1)),o("p",Qe,d(e.eventError),1),o("button",{onClick:t[0]||(t[0]=(...a)=>e.loadEvent&&e.loadEvent(...a)),class:"bg-primea-blue text-white px-6 py-2 rounded-primea hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200"}," Réessayer ")])])):e.event?(i(),l("div",Ze,[o("div",Ye,[o("div",$e,[o("div",et,[e.eventImageUrl?(i(),l("img",{key:0,src:e.eventImageUrl,alt:e.event.title,class:"w-full h-full object-cover",onError:t[1]||(t[1]=(...a)=>e.handleImageError&&e.handleImageError(...a))},null,40,tt)):(i(),l("div",ot,[g(x,{class:"w-24 h-24 text-white/50"})])),t[22]||(t[22]=o("div",{class:"absolute inset-0 bg-primea-blue/60"},null,-1)),o("div",rt,[o("div",at,d(e.getCategoryName()),1),o("h2",nt,d(e.event?.title||"Chargement..."),1),o("p",st,d(e.formatEventDate),1)])]),o("div",lt,[o("div",it,[o("div",dt,[g(k,{class:"w-5 h-5 text-primea-blue"}),o("span",ut,d(e.event?.venue_name||"Lieu à confirmer"),1)]),o("div",ct,[g(S,{class:"w-5 h-5 text-primea-blue"}),o("span",mt,d(e.eventTime),1)])])])]),o("div",vt,[o("h3",pt,d(e.isEventPassed?"Événement terminé":"Temps restant pour l'événement"),1),e.isEventPassed?(i(),l("div",bt,[o("div",yt,[g(f,{class:"w-12 h-12 text-red-500 mx-auto mb-2"}),t[23]||(t[23]=o("p",{class:"text-red-600 font-semibold"},"Cet événement est terminé",-1)),t[24]||(t[24]=o("p",{class:"text-red-500 text-sm"},"Les tickets ne sont plus disponibles",-1))])])):(i(),l("div",gt,[e.countdown.days>0?(i(),l("div",xt,[o("div",ht,d(e.countdown.days),1),t[25]||(t[25]=o("div",{class:"text-xs text-gray-600"},"JOURS",-1))])):b("",!0),o("div",ft,[o("div",wt,d(e.countdown.hours),1),t[26]||(t[26]=o("div",{class:"text-xs text-gray-600"},"HEURES",-1))]),o("div",_t,[o("div",kt,d(e.countdown.minutes),1),t[27]||(t[27]=o("div",{class:"text-xs text-gray-600"},"MIN",-1))]),o("div",St,[o("div",Pt,d(e.countdown.seconds),1),t[28]||(t[28]=o("div",{class:"text-xs text-gray-600"},"SEC",-1))])]))])]),o("div",Et,[o("h3",Ct,d(e.isEventPassed?"Achat impossible":"Votre achat"),1),e.isEventPassed?(i(),l("div",It,[g(f,{class:"w-16 h-16 text-red-500 mx-auto mb-4"}),t[30]||(t[30]=o("h4",{class:"text-lg font-semibold text-red-800 mb-2"},"Événement terminé",-1)),t[31]||(t[31]=o("p",{class:"text-red-600 mb-4"},"Cet événement s'est déjà déroulé. Il n'est plus possible d'acheter des tickets.",-1)),g(M,{to:"/events",class:"bg-primea-blue text-white px-6 py-2 rounded-primea hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200"},{default:oe(()=>[...t[29]||(t[29]=[I(" Voir d'autres événements ",-1)])]),_:1})])):b("",!0),e.isEventPassed?b("",!0):(i(),l("form",{key:1,onSubmit:t[18]||(t[18]=Ne((...a)=>e.processOrder&&e.processOrder(...a),["prevent"])),class:"space-y-6"},[o("div",null,[t[32]||(t[32]=o("label",{class:"block text-sm font-semibold text-primea-blue mb-3"},"Nombre de tickets",-1)),U(o("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=a=>e.orderForm.quantity=a),min:"1",max:"10",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-primea-lg focus:border-primea-blue focus:outline-none transition-colors",required:""},null,512),[[K,e.orderForm.quantity]])]),o("div",null,[t[34]||(t[34]=o("label",{class:"block text-sm font-semibold text-primea-blue mb-3"},"Type de ticket",-1)),U(o("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>e.orderForm.ticketTypeId=a),class:"w-full px-4 py-3 border-2 border-gray-200 rounded-primea-lg focus:border-primea-blue focus:outline-none transition-colors appearance-none bg-white",required:"",disabled:e.eventLoading||e.availableTicketTypes.length===0},[t[33]||(t[33]=o("option",{value:""},"Sélectionnez un type de ticket",-1)),(i(!0),l(qe,null,Fe(e.availableTicketTypes,a=>(i(),l("option",{key:a.id,value:a.id},d(a.name)+" - "+d(e.formatPrice(a.price))+" FCFA ("+d(e.getAvailableQuantityText(a))+") ",9,Nt))),128))],8,Mt),[[Te,e.orderForm.ticketTypeId]]),e.availableTicketTypes.length===0&&!e.eventLoading?(i(),l("div",Tt," Aucun ticket disponible pour cet événement ")):b("",!0)]),o("div",qt,[t[37]||(t[37]=o("h4",{class:"text-lg font-semibold text-primea-blue mb-4"},"Vos informations",-1)),o("div",null,[t[35]||(t[35]=o("label",{class:"block text-sm font-semibold text-primea-blue mb-2"},"Nom complet *",-1)),U(o("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>e.orderForm.guestName=a),placeholder:"Votre nom complet",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-primea-lg focus:border-primea-blue focus:outline-none transition-colors",required:""},null,512),[[K,e.orderForm.guestName]])]),o("div",null,[t[36]||(t[36]=o("label",{class:"block text-sm font-semibold text-primea-blue mb-2"},"Téléphone (optionnel)",-1)),g(F,{modelValue:e.orderForm.guestPhone,"onUpdate:modelValue":t[5]||(t[5]=a=>e.orderForm.guestPhone=a),id:"guest-phone",placeholder:"01 23 45 67",class:"w-full"},null,8,["modelValue"])])]),e.orderForm.quantity&&e.orderForm.ticketTypeId?(i(),l("div",Ft,[o("div",Vt,[t[38]||(t[38]=o("span",{class:"text-lg font-semibold text-primea-blue"},"Total à payer :",-1)),o("span",At,d(e.formatPrice(e.totalAmount))+" FCFA",1)])])):b("",!0),o("div",null,[t[47]||(t[47]=o("label",{class:"block text-sm font-semibold text-primea-blue mb-4"},"Moyen de paiement",-1)),o("div",Dt,[o("button",{type:"button",onClick:t[6]||(t[6]=a=>e.selectPaymentMethod("airtel")),class:H(["p-4 rounded-primea-lg border-2 transition-all text-center flex flex-col items-center justify-center min-h-[80px]",e.orderForm.paymentMethod==="airtel"?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300"])},[...t[39]||(t[39]=[o("img",{src:"/images/am.png",alt:"Airtel Money",class:"h-8 w-auto",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block'"},null,-1),o("div",{class:"text-red-600 font-bold text-sm",style:{display:"none"}},"airtel money",-1)])],2),o("button",{type:"button",onClick:t[7]||(t[7]=a=>e.selectPaymentMethod("moov")),class:H(["p-4 rounded-primea-lg border-2 transition-all text-center flex flex-col items-center justify-center min-h-[80px]",e.orderForm.paymentMethod==="moov"?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"])},[...t[40]||(t[40]=[o("img",{src:"/images/mm.png",alt:"Moov Money",class:"h-8 w-auto",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block'"},null,-1),o("div",{class:"bg-orange-500 text-white px-2 py-1 rounded text-xs font-bold",style:{display:"none"}},"Moov Money",-1)])],2),o("button",{type:"button",onClick:t[8]||(t[8]=a=>e.selectPaymentMethod("visa")),class:H(["p-4 rounded-primea-lg border-2 transition-all text-center flex flex-col items-center justify-center min-h-[80px]",e.orderForm.paymentMethod==="visa"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"])},[...t[41]||(t[41]=[o("img",{src:"/images/vm.png",alt:"Visa",class:"h-8 w-auto",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block'"},null,-1),o("div",{class:"text-blue-600 font-bold text-sm",style:{display:"none"}},"VISA",-1)])],2)]),e.orderForm.paymentMethod==="airtel"||e.orderForm.paymentMethod==="moov"?(i(),l("div",Ut,[o("label",{for:`payment-${e.orderForm.paymentMethod}`,class:"block text-sm font-semibold text-primea-blue mb-2"}," Numéro "+d(e.orderForm.paymentMethod==="airtel"?"Airtel Money":"Moov Money"),9,jt),U(o("input",{id:`payment-${e.orderForm.paymentMethod}`,type:"tel","onUpdate:modelValue":t[9]||(t[9]=a=>e.orderForm.phoneNumber=a),placeholder:e.orderForm.paymentMethod==="airtel"?"074123456":"062123456",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-primea-lg focus:border-primea-blue focus:outline-none transition-colors font-primea",maxlength:9,pattern:"[0-9]{9}",required:"",onInput:t[10]||(t[10]=(...a)=>e.validatePhoneNumber&&e.validatePhoneNumber(...a))},null,40,Rt),[[K,e.orderForm.phoneNumber]]),e.phoneError?(i(),l("p",Ot,d(e.phoneError),1)):(i(),l("p",Lt,d(e.orderForm.paymentMethod==="airtel"?"Format: 074xxxxxx, 076xxxxxx ou 077xxxxxx":"Format: 060xxxxxx, 062xxxxxx, 065xxxxxx ou 066xxxxxx"),1))])):b("",!0),e.orderForm.paymentMethod==="visa"?(i(),l("div",Bt,[o("div",zt,[t[44]||(t[44]=o("p",{class:"text-blue-800 mb-4 font-semibold"},"Paiement Visa sécurisé",-1)),t[45]||(t[45]=o("p",{class:"text-blue-600 text-sm mb-4"},"Vous allez être redirigé vers notre partenaire de paiement sécurisé",-1)),o("button",{type:"button",onClick:t[11]||(t[11]=(...a)=>e.redirectToVisaPayment&&e.redirectToVisaPayment(...a)),class:"bg-blue-600 text-white px-6 py-3 rounded-primea-lg font-semibold hover:bg-blue-700 transition-all duration-200 flex items-center justify-center gap-2 mx-auto"},[t[42]||(t[42]=o("img",{src:"/images/visa-logo.png",alt:"Visa",class:"h-6 w-auto",onerror:"this.style.display='none'"},null,-1)),t[43]||(t[43]=I(" Procéder au paiement Visa ",-1)),g(V,{class:"w-4 h-4"})]),t[46]||(t[46]=o("p",{class:"text-xs text-gray-500 mt-2"},"Paiement 100% sécurisé avec chiffrement SSL",-1))])])):b("",!0)]),e.error?(i(),l("div",Wt,[o("p",Jt,d(e.error),1)])):b("",!0),e.ussdPushActive?(i(),l("div",Kt,[o("div",Ht,[e.paymentStatus==="pending"?(i(),l("div",Xt,[t[52]||(t[52]=o("div",{class:"flex items-center justify-center mb-4"},[o("div",{class:"w-16 h-16 border-4 border-blue-300 border-t-blue-600 rounded-full animate-spin"})],-1)),t[53]||(t[53]=o("h4",{class:"text-xl font-bold text-blue-800 mb-2"},"Push envoyé !",-1)),o("p",Gt,[t[48]||(t[48]=I(" Un push USSD a été envoyé au numéro ",-1)),o("span",Qt,d(e.formatPhoneForDisplay(e.currentPayment?.phone)),1),t[49]||(t[49]=I(". Veuillez valider le paiement sur votre téléphone. ",-1))]),o("div",Zt,[o("div",Yt,d(e.formatCountdown(e.ussdCountdown)),1),t[50]||(t[50]=o("div",{class:"text-sm text-blue-500"},"Temps restant pour valider",-1)),o("div",$t,[o("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-1000",style:Ve({width:e.ussdCountdown/90*100+"%"})},null,4)])]),o("p",eo,[t[51]||(t[51]=I(" Montant: ",-1)),o("span",to,d(e.formatPrice(e.totalAmount))+" FCFA",1)]),o("div",oo,[o("button",{onClick:t[12]||(t[12]=(...a)=>e.retryUSSDPush&&e.retryUSSDPush(...a)),disabled:e.loading||e.ussdCountdown>0,class:"bg-blue-600 text-white px-4 py-2 rounded-primea hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[e.loading?(i(),l("span",ao,"Envoi...")):(i(),l("span",no,"Renvoyer le push"))],8,ro),e.currentPayment.payment_url&&e.currentPayment.bill_id?(i(),l("button",{key:0,onClick:t[13]||(t[13]=(...a)=>e.payViaWebPage&&e.payViaWebPage(...a)),class:"bg-green-600 text-white px-4 py-2 rounded-primea hover:bg-green-700 transition-colors"}," Payer via page web ")):b("",!0),o("button",{onClick:t[14]||(t[14]=(...a)=>e.changeOperator&&e.changeOperator(...a)),disabled:e.ussdCountdown>0,class:"bg-gray-500 text-white px-4 py-2 rounded-primea hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Changer d'opérateur ",8,so),o("button",{onClick:t[15]||(t[15]=(...a)=>e.cancelUSSDPush&&e.cancelUSSDPush(...a)),class:"bg-red-500 text-white px-4 py-2 rounded-primea hover:bg-red-600 transition-colors"}," Annuler ")])])):e.paymentStatus==="successful"?(i(),l("div",lo,[...t[54]||(t[54]=[re('<div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4" data-v-b527c22a><svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-b527c22a><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-b527c22a></path></svg></div><h4 class="text-xl font-bold text-green-800 mb-2" data-v-b527c22a>Paiement réussi !</h4><p class="text-green-700 mb-4" data-v-b527c22a>Votre paiement a été validé avec succès.</p><p class="text-green-600 text-sm" data-v-b527c22a>Redirection en cours vers votre ticket...</p>',4)])])):e.paymentStatus==="failed"||e.paymentStatus==="cancelled"||e.paymentStatus==="expired"?(i(),l("div",io,[t[55]||(t[55]=o("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},[o("svg",{class:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),t[56]||(t[56]=o("h4",{class:"text-xl font-bold text-red-800 mb-2"},"Paiement échoué",-1)),o("p",uo,d(e.paymentStatus==="cancelled"?"Le paiement a été annulé.":e.paymentStatus==="expired"?"Le délai de paiement a expiré.":"Le paiement a échoué. Veuillez réessayer."),1),o("div",co,[o("button",{onClick:t[16]||(t[16]=(...a)=>e.retryUSSDPush&&e.retryUSSDPush(...a)),class:"bg-blue-600 text-white px-4 py-2 rounded-primea hover:bg-blue-700 transition-colors"}," Réessayer "),o("button",{onClick:t[17]||(t[17]=(...a)=>e.changeOperator&&e.changeOperator(...a)),class:"bg-gray-500 text-white px-4 py-2 rounded-primea hover:bg-gray-600 transition-colors"}," Changer d'opérateur ")])])):b("",!0)])])):b("",!0),e.ussdPushActive?b("",!0):(i(),l("button",{key:3,type:"submit",disabled:e.loading||!e.isFormValid,class:"w-full bg-primea-blue text-white py-4 px-6 rounded-primea-lg text-lg font-bold hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200 shadow-primea-lg transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",style:{"background-color":"#272d63"}},[e.loading?(i(),l("span",vo,[...t[57]||(t[57]=[o("svg",{class:"w-6 h-6 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24"},[o("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",class:"opacity-25"}),o("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",class:"opacity-75"})],-1),I(" Traitement en cours... ",-1)])])):(i(),l("span",po,"Finaliser le paiement"))],8,mo)),o("div",bo,[g(M,{to:"/retrieve-ticket",class:"text-primea-blue hover:text-primea-yellow transition-colors"},{default:oe(()=>[...t[58]||(t[58]=[I(" Récupérer mon ticket perdu ",-1)])]),_:1})])],32))])])):b("",!0)])])]),o("div",yo,[o("div",go,[o("div",xo,[o("button",{onClick:t[19]||(t[19]=(...a)=>e.goBack&&e.goBack(...a)),class:"text-gray-600 hover:text-gray-800"},[g(P,{class:"w-6 h-6"})]),t[60]||(t[60]=re('<div class="text-center" data-v-b527c22a><img src="/images/logo.png" alt="Primea" class="h-8 mx-auto mb-2" data-v-b527c22a><div class="text-right" data-v-b527c22a><div class="text-lg font-bold text-blue-600" data-v-b527c22a>La Billetterie</div><div class="text-xs text-gray-500" data-v-b527c22a>Simple, Rapide et Sécurisée</div></div></div>',1)),o("button",ho,[g(y,{class:"w-6 h-6"})])]),t[61]||(t[61]=o("div",{class:"text-center text-gray-500 py-8"}," Version mobile en cours de développement ",-1))])])])}const Io=Oe(Be,[["render",fo],["__scopeId","data-v-b527c22a"]]);export{Io as default};
