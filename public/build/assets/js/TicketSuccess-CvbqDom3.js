import{D,K as E,g as i,o as l,h as e,l as A,j as c,k as b,a as C,t as a,A as f,F as I,q as F,b as _,e as R,B as S,N as P}from"./vue-vendor-CGc-1SHl.js";import{_ as V,u as B}from"./account-DdQQgQO1.js";import"./pinia-vendor-C7xpF7iQ.js";import"./vendor-BvANJOFB.js";const q={name:"TicketSuccess",components:{CheckCircleIcon:E,ExclamationCircleIcon:D},setup(){const N=S();P();const t=B(),p=_(!0),o=_(""),h=_(null),m=_([]),d=async()=>{const s=N.query.reference;if(!s){o.value="Référence de commande manquante",p.value=!1;return}try{p.value=!0,o.value="";const r=t.isAuthenticated,k=r?`/api/v1/orders/${s}`:`/api/v1/guest/orders/${s}`,x={Accept:"application/json"};if(r){const v=localStorage.getItem("auth_token")||localStorage.getItem("token");v&&(x.Authorization=`Bearer ${v}`)}const g=await fetch(k,{headers:x});if(!g.ok)throw new Error("Commande introuvable");const u=await g.json();if(u.success)h.value=u.data.order,m.value=u.data.order.tickets||[];else throw new Error(u.message||"Erreur lors du chargement de la commande")}catch(r){console.error("Erreur lors du chargement de la commande:",r),o.value=r.message||"Impossible de charger votre commande"}finally{p.value=!1}},y=s=>new Intl.NumberFormat("fr-FR").format(s),w=s=>{if(!s)return"N/A";try{if(typeof s=="string"&&s.includes("/")){const[k,x]=s.split(" "),[g,u,v]=k.split("/"),T=`${v}-${u}-${g}${x?"T"+x:""}`,j=new Date(T);return isNaN(j.getTime())?"N/A":j.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}const r=new Date(s);return isNaN(r.getTime())?"N/A":r.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(r){return console.error("Erreur parsing date:",r),"N/A"}},n=()=>{!m.value||m.value.length===0||m.value.forEach((s,r)=>{setTimeout(()=>{window.open(`/ticket/${s.code}/download`,"_blank")},r*500)})};return R(()=>{d()}),{authStore:t,loading:p,error:o,order:h,tickets:m,formatPrice:y,formatDate:w,downloadAllTickets:n}}},L={class:"ticket-success-page min-h-screen bg-gray-50 font-primea"},O={class:"container mx-auto px-4 py-12"},M={class:"max-w-2xl mx-auto"},U={class:"text-center mb-8"},X={key:0,class:"bg-white rounded-primea-xl shadow-primea p-8 text-center"},z={key:1,class:"bg-white rounded-primea-xl shadow-primea p-8"},K={class:"text-center mb-6"},Q={class:"text-red-600"},G={class:"text-center"},H={key:2,class:"bg-white rounded-primea-xl shadow-primea p-8"},J={class:"text-center mb-8"},W={class:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},Y={class:"bg-primea-blue/5 rounded-primea-lg p-6 mb-6"},Z={class:"space-y-3"},$={class:"flex justify-between"},ee={class:"font-semibold text-primea-blue"},te={class:"flex justify-between"},oe={class:"font-semibold"},se={class:"flex justify-between"},re={class:"font-semibold"},ae={class:"flex justify-between pt-2 border-t border-gray-300"},ne={class:"font-bold text-green-600 text-lg"},ie={class:"flex justify-between"},le={class:"text-xs text-gray-500"},de={class:"flex justify-between mt-3"},ce={class:"font-semibold"},me={key:0,class:"mb-6"},ue={class:"space-y-3"},pe={class:"flex justify-between items-center"},xe={class:"font-semibold text-primea-blue"},be={class:"text-sm text-gray-600"},fe={class:"text-center mb-6"},ge={class:"bg-blue-50 border border-blue-200 rounded-primea-lg p-4 mb-6 text-center"},ve={class:"text-blue-800 text-sm"},_e={class:"flex flex-col sm:flex-row gap-4 justify-center"};function he(N,t,p,o,h,m){const d=C("router-link"),y=C("ExclamationCircleIcon"),w=C("CheckCircleIcon");return l(),i("div",L,[e("div",O,[e("div",M,[e("div",U,[c(d,{to:"/"},{default:b(()=>[...t[1]||(t[1]=[e("img",{src:"/images/logo.png",alt:"Primea",class:"h-16 mx-auto mb-6"},null,-1)])]),_:1})]),o.loading?(l(),i("div",X,[...t[2]||(t[2]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-primea-blue mx-auto mb-4"},null,-1),e("p",{class:"text-gray-600"},"Chargement de votre commande...",-1)])])):o.error?(l(),i("div",z,[e("div",K,[c(y,{class:"w-16 h-16 text-red-500 mx-auto mb-4"}),t[3]||(t[3]=e("h2",{class:"text-2xl font-bold text-red-800 mb-2"},"Erreur",-1)),e("p",Q,a(o.error),1)]),e("div",G,[c(d,{to:"/events",class:"inline-block bg-primea-blue text-white px-6 py-3 rounded-primea hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200"},{default:b(()=>[...t[4]||(t[4]=[f(" Retour aux événements ",-1)])]),_:1})])])):o.order?(l(),i("div",H,[e("div",J,[e("div",W,[c(w,{class:"w-12 h-12 text-green-600"})]),t[5]||(t[5]=e("h1",{class:"text-3xl font-bold text-primea-blue mb-2"},"Paiement réussi !",-1)),t[6]||(t[6]=e("p",{class:"text-gray-600"},"Votre commande a été confirmée",-1))]),e("div",Y,[t[13]||(t[13]=e("h3",{class:"text-lg font-bold text-primea-blue mb-4"},"Détails de votre commande",-1)),e("div",Z,[e("div",$,[t[7]||(t[7]=e("span",{class:"text-gray-600"},"Référence :",-1)),e("span",ee,a(o.order.reference),1)]),e("div",te,[t[8]||(t[8]=e("span",{class:"text-gray-600"},"Événement :",-1)),e("span",oe,a(o.order.event?.title||"N/A"),1)]),e("div",se,[t[9]||(t[9]=e("span",{class:"text-gray-600"},"Quantité :",-1)),e("span",re,a(o.order.quantity)+" ticket(s)",1)]),e("div",ae,[t[10]||(t[10]=e("span",{class:"text-gray-800 font-semibold"},"Montant payé :",-1)),e("span",ne,a(o.formatPrice(o.order.total_amount))+" XAF",1)]),e("div",ie,[t[11]||(t[11]=e("span",{class:"text-xs text-gray-500"},"dont frais et taxes inclus :",-1)),e("span",le,a(o.formatPrice(parseFloat(o.order.fees_amount||0)+parseFloat(o.order.tax_amount||0)))+" XAF",1)]),e("div",de,[t[12]||(t[12]=e("span",{class:"text-gray-600"},"Date :",-1)),e("span",ce,a(o.formatDate(o.order.created_at)),1)])])]),o.tickets&&o.tickets.length>0?(l(),i("div",me,[t[15]||(t[15]=e("h3",{class:"text-lg font-bold text-primea-blue mb-4"},"Vos tickets",-1)),e("div",ue,[(l(!0),i(I,null,F(o.tickets,n=>(l(),i("div",{key:n.id,class:"bg-gray-50 border-2 border-primea-blue rounded-primea-lg p-4 hover:shadow-md transition-shadow"},[e("div",pe,[e("div",null,[e("p",xe,a(n.ticket_type?.name||"Ticket"),1),e("p",be,"Code: "+a(n.code),1)]),c(d,{to:`/ticket/${n.code}/download`,class:"bg-primea-blue text-white px-4 py-2 rounded-primea text-sm hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200"},{default:b(()=>[...t[14]||(t[14]=[f(" Télécharger ",-1)])]),_:1},8,["to"])])]))),128))])])):A("",!0),e("div",fe,[o.tickets&&o.tickets.length>0?(l(),i("button",{key:0,onClick:t[0]||(t[0]=(...n)=>o.downloadAllTickets&&o.downloadAllTickets(...n)),class:"bg-primea-blue text-white px-8 py-3 rounded-primea-lg font-bold hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200 shadow-primea-lg transform hover:scale-105"}," Télécharger tous les tickets ")):A("",!0)]),e("div",ge,[e("p",ve,[t[16]||(t[16]=f(" Un email de confirmation avec vos tickets a été envoyé à ",-1)),e("strong",null,a(o.order.guest_email||"votre adresse email"),1)])]),e("div",_e,[c(d,{to:"/events",class:"text-center bg-gray-100 text-primea-blue px-6 py-3 rounded-primea hover:bg-gray-200 transition-all duration-200"},{default:b(()=>[...t[17]||(t[17]=[f(" Voir d'autres événements ",-1)])]),_:1}),c(d,{to:"/",class:"text-center bg-primea-yellow text-primea-blue px-6 py-3 rounded-primea hover:bg-yellow-500 transition-all duration-200 font-semibold"},{default:b(()=>[...t[18]||(t[18]=[f(" Retour à l'accueil ",-1)])]),_:1})])])):A("",!0)])])])}const Ce=V(q,[["render",he],["__scopeId","data-v-47c7af47"]]);export{Ce as default};
