import{as as I,aB as S,K as M,g as i,o as n,h as t,j as c,a as p,k as w,A as a,l as j,t as h,b as u,d as z,e as B,B as A,N as D}from"./vue-vendor-CGc-1SHl.js";import{_ as N,u as R,c as k}from"./account-CFgrfDiH.js";import"./pinia-vendor-C7xpF7iQ.js";import"./vendor-BvANJOFB.js";const H={name:"EmailVerification",components:{CheckCircleIcon:M,EnvelopeIcon:S,XMarkIcon:I},setup(){const _=A(),e=D(),b=R(),s=u("loading"),d=u(""),m=u(!1),l=u(!1),r=u(0),x=z(()=>b.user?.email||"");B(async()=>{const{id:o,hash:v}=_.params;o&&v?await g(o,v):await y()});const g=async(o,v)=>{try{const f=await fetch(`/api/v1/auth/email/verify/${o}/${v}`),V=await f.json();f.ok?s.value="success":(s.value="error",d.value=V.message)}catch(f){console.error("Erreur de vérification:",f),s.value="error",d.value="Une erreur est survenue"}},y=async()=>{try{if(!b.isAuthenticated){e.push("/login");return}(await k.checkEmailVerification()).data.email_verified?s.value="success":s.value="pending"}catch(o){console.error("Erreur lors de la vérification du statut:",o),s.value="pending"}},C=async()=>{if(!(r.value>0))try{m.value=!0,l.value=!1,await k.resendEmailVerification(),l.value=!0,E(),setTimeout(()=>{l.value=!1},5e3)}catch(o){console.error("Erreur lors du renvoi:",o),d.value="Impossible de renvoyer l'email"}finally{m.value=!1}},E=()=>{r.value=60;const o=setInterval(()=>{r.value--,r.value<=0&&clearInterval(o)},1e3)};return{verificationStatus:s,errorMessage:d,resending:m,resendSuccess:l,resendCooldown:r,userEmail:x,resendVerification:C}}},q={class:"email-verification-page font-primea relative overflow-hidden min-h-screen"},X={class:"relative z-10 min-h-screen flex items-center justify-center px-4 py-12"},G={class:"max-w-md w-full"},L={class:"bg-white/95 backdrop-blur-sm rounded-primea-xl shadow-primea-lg p-8 animate-slide-up"},P={key:0,class:"text-center"},T={class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},U={key:1,class:"text-center"},W={class:"w-16 h-16 bg-primea-blue/10 rounded-full flex items-center justify-center mx-auto mb-4"},K={class:"text-gray-600 mb-6"},Y=["disabled"],F={key:0,class:"flex items-center justify-center"},J={key:1},O={key:2},Q={key:0,class:"bg-green-50 border border-green-200 rounded-primea p-4 mb-4"},Z={class:"text-center"},$={key:2,class:"text-center"},ee={class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},te={class:"text-gray-600 mb-6"},se={key:3,class:"text-center"};function oe(_,e,b,s,d,m){const l=p("CheckCircleIcon"),r=p("router-link"),x=p("EnvelopeIcon"),g=p("XMarkIcon");return n(),i("div",q,[e[15]||(e[15]=t("div",{class:"absolute inset-0"},[t("img",{src:"https://images.unsplash.com/photo-1540575467063-178a50c2df87?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",alt:"Événements",class:"w-full h-full object-cover opacity-40"}),t("div",{class:"absolute inset-0 bg-primea-blue/60"})],-1)),t("div",X,[t("div",G,[e[14]||(e[14]=t("div",{class:"text-center mb-8 animate-fade-in"},[t("img",{src:"/images/logo_white.png",alt:"Primea",class:"h-16 mx-auto mb-6"})],-1)),t("div",L,[s.verificationStatus==="success"?(n(),i("div",P,[t("div",T,[c(l,{class:"w-10 h-10 text-green-500"})]),e[2]||(e[2]=t("h1",{class:"text-2xl font-bold text-primea-blue mb-4"}," Email vérifié ! ",-1)),e[3]||(e[3]=t("p",{class:"text-gray-600 mb-6"}," Votre adresse email a été vérifiée avec succès. Vous pouvez maintenant accéder à toutes les fonctionnalités de Primea. ",-1)),c(r,{to:"/login",class:"inline-block w-full py-3 px-6 bg-primea-blue text-white rounded-primea hover:bg-primea-yellow hover:text-primea-blue font-semibold transition-all duration-200 text-center"},{default:w(()=>[...e[1]||(e[1]=[a(" Se connecter ",-1)])]),_:1})])):s.verificationStatus==="pending"?(n(),i("div",U,[t("div",W,[c(x,{class:"w-10 h-10 text-primea-blue"})]),e[9]||(e[9]=t("h1",{class:"text-2xl font-bold text-primea-blue mb-4"}," Vérifiez votre email ",-1)),t("p",K,[e[4]||(e[4]=a(" Un email de vérification a été envoyé à ",-1)),t("strong",null,h(s.userEmail),1),e[5]||(e[5]=a(". Cliquez sur le lien dans l'email pour activer votre compte. ",-1))]),e[10]||(e[10]=t("div",{class:"bg-primea-blue/5 border border-primea-blue/20 rounded-primea p-4 mb-6"},[t("p",{class:"text-sm text-primea-blue"},[t("strong",null,"Vous n'avez pas reçu l'email ?"),t("br"),a(" Vérifiez votre dossier spam ou cliquez sur le bouton ci-dessous pour renvoyer un nouvel email. ")])],-1)),t("button",{onClick:e[0]||(e[0]=(...y)=>s.resendVerification&&s.resendVerification(...y)),disabled:s.resending||s.resendCooldown>0,class:"w-full py-3 px-6 bg-primea-yellow text-primea-blue rounded-primea hover:bg-primea-blue hover:text-white font-semibold transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed mb-4"},[s.resending?(n(),i("span",F,[...e[6]||(e[6]=[t("svg",{class:"animate-spin h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),a(" Envoi en cours... ",-1)])])):s.resendCooldown>0?(n(),i("span",J," Renvoyer dans "+h(s.resendCooldown)+"s ",1)):(n(),i("span",O," Renvoyer l'email de vérification "))],8,Y),s.resendSuccess?(n(),i("div",Q,[...e[7]||(e[7]=[t("p",{class:"text-green-700 text-sm font-medium"}," Email de vérification renvoyé avec succès ! ",-1)])])):j("",!0),t("div",Z,[c(r,{to:"/login",class:"text-sm text-primea-blue hover:text-primea-yellow font-semibold transition-colors duration-200"},{default:w(()=>[...e[8]||(e[8]=[a(" Retour à la connexion ",-1)])]),_:1})])])):s.verificationStatus==="error"?(n(),i("div",$,[t("div",ee,[c(g,{class:"w-10 h-10 text-red-500"})]),e[12]||(e[12]=t("h1",{class:"text-2xl font-bold text-red-600 mb-4"}," Erreur de vérification ",-1)),t("p",te,h(s.errorMessage||"Le lien de vérification est invalide ou a expiré."),1),c(r,{to:"/register",class:"inline-block w-full py-3 px-6 bg-primea-blue text-white rounded-primea hover:bg-primea-yellow hover:text-primea-blue font-semibold transition-all duration-200 text-center"},{default:w(()=>[...e[11]||(e[11]=[a(" Créer un nouveau compte ",-1)])]),_:1})])):(n(),i("div",se,[...e[13]||(e[13]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-primea-blue mx-auto mb-4"},null,-1),t("p",{class:"text-gray-500"},"Vérification en cours...",-1)])]))])])])])}const le=N(H,[["render",oe],["__scopeId","data-v-3ce914e7"]]);export{le as default};
