import{D,K as E,b as i,d as l,e,i as A,g as u,q as C,t as n,h as v,A as x,F as I,k as F,r as h,o as R,B as S,N as V}from"./vue-vendor-DL4qlPdi.js";import{_ as P,u as B}from"./account-CS5tkP3W.js";import"./vendor-14XLBY50.js";import"./pinia-vendor-DSZd9EMP.js";const q={name:"TicketSuccess",components:{CheckCircleIcon:E,ExclamationCircleIcon:D},setup(){const N=S();V();const t=B(),p=h(!0),o=h(""),_=h(null),d=h([]),y=async()=>{const s=N.query.reference;if(!s){o.value="Référence de commande manquante",p.value=!1;return}try{p.value=!0,o.value="";const r=t.isAuthenticated,k=r?`/api/v1/orders/${s}`:`/api/v1/guest/orders/${s}`,b={Accept:"application/json"};if(r){const g=localStorage.getItem("auth_token")||localStorage.getItem("token");g&&(b.Authorization=`Bearer ${g}`)}const f=await fetch(k,{headers:b});if(!f.ok)throw new Error("Commande introuvable");const m=await f.json();if(m.success)_.value=m.data.order,d.value=m.data.order.tickets||[];else throw new Error(m.message||"Erreur lors du chargement de la commande")}catch(r){console.error("Erreur lors du chargement de la commande:",r),o.value=r.message||"Impossible de charger votre commande"}finally{p.value=!1}},c=s=>new Intl.NumberFormat("fr-FR").format(s),w=s=>{if(!s)return"N/A";try{if(typeof s=="string"&&s.includes("/")){const[k,b]=s.split(" "),[f,m,g]=k.split("/"),T=`${g}-${m}-${f}${b?"T"+b:""}`,j=new Date(T);return isNaN(j.getTime())?"N/A":j.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}const r=new Date(s);return isNaN(r.getTime())?"N/A":r.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(r){return console.error("Erreur parsing date:",r),"N/A"}},a=()=>{!d.value||d.value.length===0||d.value.forEach((s,r)=>{setTimeout(()=>{window.open(`/ticket/${s.code}/download`,"_blank")},r*500)})};return R(()=>{y()}),{authStore:t,loading:p,error:o,order:_,tickets:d,formatPrice:c,formatDate:w,downloadAllTickets:a}}},L={class:"ticket-success-page min-h-screen bg-gray-50 font-primea"},O={class:"container mx-auto px-4 py-12"},M={class:"max-w-2xl mx-auto"},U={key:0,class:"bg-white rounded-primea-xl shadow-primea p-8 text-center"},X={key:1,class:"bg-white rounded-primea-xl shadow-primea p-8"},z={class:"text-center mb-6"},K={class:"text-red-600"},Q={class:"text-center"},G={key:2,class:"bg-white rounded-primea-xl shadow-primea p-8"},H={class:"text-center mb-8"},J={class:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},W={class:"bg-primea-blue/5 rounded-primea-lg p-6 mb-6"},Y={class:"space-y-3"},Z={class:"flex justify-between"},$={class:"font-semibold text-primea-blue"},ee={class:"flex justify-between"},te={class:"font-semibold"},oe={class:"flex justify-between"},se={class:"font-semibold"},re={class:"flex justify-between pt-2 border-t border-gray-300"},ne={class:"font-bold text-green-600 text-lg"},ae={class:"flex justify-between"},ie={class:"text-xs text-gray-500"},le={class:"flex justify-between mt-3"},de={class:"font-semibold"},ce={key:0,class:"mb-6"},me={class:"space-y-3"},ue={class:"flex justify-between items-center"},pe={class:"font-semibold text-primea-blue"},be={class:"text-sm text-gray-600"},xe={class:"text-center mb-6"},fe={class:"bg-blue-50 border border-blue-200 rounded-primea-lg p-4 mb-6 text-center"},ge={class:"text-blue-800 text-sm"},ve={class:"flex flex-col sm:flex-row gap-4 justify-center"};function he(N,t,p,o,_,d){const y=C("ExclamationCircleIcon"),c=C("router-link"),w=C("CheckCircleIcon");return l(),i("div",L,[e("div",O,[e("div",M,[o.loading?(l(),i("div",U,[...t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-primea-blue mx-auto mb-4"},null,-1),e("p",{class:"text-gray-600"},"Chargement de votre commande...",-1)])])):o.error?(l(),i("div",X,[e("div",z,[u(y,{class:"w-16 h-16 text-red-500 mx-auto mb-4"}),t[2]||(t[2]=e("h2",{class:"text-2xl font-bold text-red-800 mb-2"},"Erreur",-1)),e("p",K,n(o.error),1)]),e("div",Q,[u(c,{to:"/events",class:"inline-block bg-primea-blue text-white px-6 py-3 rounded-primea hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200"},{default:v(()=>[...t[3]||(t[3]=[x(" Retour aux événements ",-1)])]),_:1})])])):o.order?(l(),i("div",G,[e("div",H,[e("div",J,[u(w,{class:"w-12 h-12 text-green-600"})]),t[4]||(t[4]=e("h1",{class:"text-3xl font-bold text-primea-blue mb-2"},"Paiement réussi !",-1)),t[5]||(t[5]=e("p",{class:"text-gray-600"},"Votre commande a été confirmée",-1))]),e("div",W,[t[12]||(t[12]=e("h3",{class:"text-lg font-bold text-primea-blue mb-4"},"Détails de votre commande",-1)),e("div",Y,[e("div",Z,[t[6]||(t[6]=e("span",{class:"text-gray-600"},"Référence :",-1)),e("span",$,n(o.order.reference),1)]),e("div",ee,[t[7]||(t[7]=e("span",{class:"text-gray-600"},"Événement :",-1)),e("span",te,n(o.order.event?.title||"N/A"),1)]),e("div",oe,[t[8]||(t[8]=e("span",{class:"text-gray-600"},"Quantité :",-1)),e("span",se,n(o.order.quantity)+" ticket(s)",1)]),e("div",re,[t[9]||(t[9]=e("span",{class:"text-gray-800 font-semibold"},"Montant payé :",-1)),e("span",ne,n(o.formatPrice(o.order.total_amount))+" XAF",1)]),e("div",ae,[t[10]||(t[10]=e("span",{class:"text-xs text-gray-500"},"dont frais et taxes inclus :",-1)),e("span",ie,n(o.formatPrice(parseFloat(o.order.fees_amount||0)+parseFloat(o.order.tax_amount||0)))+" XAF",1)]),e("div",le,[t[11]||(t[11]=e("span",{class:"text-gray-600"},"Date :",-1)),e("span",de,n(o.formatDate(o.order.created_at)),1)])])]),o.tickets&&o.tickets.length>0?(l(),i("div",ce,[t[14]||(t[14]=e("h3",{class:"text-lg font-bold text-primea-blue mb-4"},"Vos tickets",-1)),e("div",me,[(l(!0),i(I,null,F(o.tickets,a=>(l(),i("div",{key:a.id,class:"bg-gray-50 border-2 border-primea-blue rounded-primea-lg p-4 hover:shadow-md transition-shadow"},[e("div",ue,[e("div",null,[e("p",pe,n(a.ticket_type?.name||"Ticket"),1),e("p",be,"Code: "+n(a.code),1)]),u(c,{to:`/ticket/${a.code}/download`,class:"bg-primea-blue text-white px-4 py-2 rounded-primea text-sm hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200"},{default:v(()=>[...t[13]||(t[13]=[x(" Télécharger ",-1)])]),_:1},8,["to"])])]))),128))])])):A("",!0),e("div",xe,[o.tickets&&o.tickets.length>0?(l(),i("button",{key:0,onClick:t[0]||(t[0]=(...a)=>o.downloadAllTickets&&o.downloadAllTickets(...a)),class:"bg-primea-blue text-white px-8 py-3 rounded-primea-lg font-bold hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200 shadow-primea-lg transform hover:scale-105"}," Télécharger tous les tickets ")):A("",!0)]),e("div",fe,[e("p",ge,[t[15]||(t[15]=x(" Un email de confirmation avec vos tickets a été envoyé à ",-1)),e("strong",null,n(o.order.guest_email||"votre adresse email"),1)])]),e("div",ve,[u(c,{to:"/events",class:"text-center bg-gray-100 text-primea-blue px-6 py-3 rounded-primea hover:bg-gray-200 transition-all duration-200"},{default:v(()=>[...t[16]||(t[16]=[x(" Voir d'autres événements ",-1)])]),_:1}),u(c,{to:"/",class:"text-center bg-primea-yellow text-primea-blue px-6 py-3 rounded-primea hover:bg-yellow-500 transition-all duration-200 font-semibold"},{default:v(()=>[...t[17]||(t[17]=[x(" Retour à l'accueil ",-1)])]),_:1})])])):A("",!0)])])])}const Ae=P(q,[["render",he],["__scopeId","data-v-e8c9b04d"]]);export{Ae as default};
