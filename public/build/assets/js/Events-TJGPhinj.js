import{O as W,b as n,d as a,e as t,i as u,j as S,f as z,v as D,A as y,t as d,F as w,k,n as P,m as N,q as j,g as I,h as Y,r as E,c as R,o as Z,B as J,w as K,N as $}from"./vue-vendor-Crt3CPuW.js";import{u as ee}from"./events-JVM0Qz6c.js";import{E as te}from"./EventCard-DmCdp5Ly.js";import{_ as oe}from"./account-k_xqo_mH.js";import"./vendor-CzIG1j6G.js";import"./pinia-vendor-DHhcPo2H.js";const re={name:"Events",components:{EventCard:te,ExclamationTriangleIcon:W},setup(){const v=$(),r=J(),L=ee(),o=E([]),M=E(!0),g=E("all"),_=E([]),m=E(""),C=s=>{try{const l=s.event_date||s.date;return l?new Date(l)<new Date:!1}catch{return!1}},e=R(()=>{let s=o.value;if(g.value!=="all"&&(s=s.filter(i=>(i.category?.id||i.category_id)===parseInt(g.value))),m.value&&m.value.trim()){const i=m.value.toLowerCase().trim();s=s.filter(c=>{const x=c.title?.toLowerCase().includes(i),p=c.description?.toLowerCase().includes(i),b=c.venue_name?.toLowerCase().includes(i)||c.venue?.name?.toLowerCase().includes(i)||typeof c.venue=="string"&&c.venue?.toLowerCase().includes(i),h=c.organizer?.name?.toLowerCase().includes(i)||typeof c.organizer=="string"&&c.organizer?.toLowerCase().includes(i),T=c.category?.name?.toLowerCase().includes(i)||c.category_name?.toLowerCase().includes(i);return x||p||b||h||T})}return s.filter(i=>!C(i)).sort((i,c)=>{const x=p=>p.sold_quantity!==void 0?p.sold_quantity:p.tickets_sold!==void 0?p.tickets_sold:p.ticket_types&&Array.isArray(p.ticket_types)?p.ticket_types.reduce((b,h)=>b+(h.sold_quantity||h.sold||0),0):0;return x(c)-x(i)})}),f=R(()=>{let s=o.value;if(g.value!=="all"&&(s=s.filter(l=>(l.category?.id||l.category_id)===parseInt(g.value))),m.value&&m.value.trim()){const l=m.value.toLowerCase().trim();s=s.filter(i=>{const c=i.title?.toLowerCase().includes(l),x=i.description?.toLowerCase().includes(l),p=i.venue_name?.toLowerCase().includes(l)||i.venue?.name?.toLowerCase().includes(l)||typeof i.venue=="string"&&i.venue?.toLowerCase().includes(l),b=i.organizer?.name?.toLowerCase().includes(l)||typeof i.organizer=="string"&&i.organizer?.toLowerCase().includes(l),h=i.category?.name?.toLowerCase().includes(l)||i.category_name?.toLowerCase().includes(l);return c||x||p||b||h})}return s.filter(l=>C(l))}),B=async()=>{try{M.value=!0;const s=await L.fetchEvents();o.value=s.events||[]}catch(s){console.error("Erreur lors du chargement des événements:",s),o.value=[]}finally{M.value=!1}},q=async()=>{try{const s=await fetch("/api/client/categories",{headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const l=await s.json();l.success&&l.categories&&(_.value=[{id:"all",name:"Tous"},...l.categories.map(i=>({id:i.id,name:i.name,slug:i.slug}))])}catch(s){console.error("Erreur lors du chargement des catégories:",s),_.value=[{id:"all",name:"Tous"},{id:1,name:"Musique"},{id:2,name:"Culture"},{id:3,name:"Gastronomie"},{id:4,name:"Sport"},{id:5,name:"Business"}]}},V=s=>{if(!s)return"--";try{let l;if(s.includes("T")||s.includes("Z"))l=new Date(s);else if(s.includes("/")){const h=s.split(" "),[T,O,G]=h[0].split("/"),U=h[1]||"00:00:00";l=new Date(`${G}-${O.padStart(2,"0")}-${T.padStart(2,"0")}T${U}`)}else s.includes("-")?l=new Date(s.replace(" ","T")):l=new Date(s);if(isNaN(l.getTime()))return"--";const i=l.getDate().toString().padStart(2,"0"),c=(l.getMonth()+1).toString().padStart(2,"0"),x=l.getFullYear(),p=l.getHours().toString().padStart(2,"0"),b=l.getMinutes().toString().padStart(2,"0");return`${i}/${c}/${x} ${p}:${b}`}catch{return"--"}},A=s=>!s||s===0?"Gratuit":new Intl.NumberFormat("fr-FR").format(s),F=s=>{v.push(`/events/${s.slug}`)},Q=s=>{g.value=s.toString()},X=()=>{m.value&&m.value.trim()&&v.push({path:"/events",query:{search:m.value.trim()}})},H=()=>{m.value="",v.push({path:"/events"})};return Z(()=>{r.query.search&&(m.value=r.query.search),r.query.category&&(g.value=r.query.category.toString()),B(),q()}),K(()=>r.query,s=>{s.category?g.value=s.category.toString():g.value="all",s.search?m.value=s.search:!s.search&&m.value&&(m.value="")}),{events:o,loading:M,selectedCategory:g,categories:_,searchQuery:m,filteredEvents:e,pastEvents:f,isEventPast:C,formatEventDate:V,formatPrice:A,goToEvent:F,filterByCategory:Q,performSearch:X,clearSearch:H,loadEvents:B,loadCategories:q,eventsStore:L}}},se={class:"events-page min-h-screen bg-gray-50 font-primea"},ie={class:"hidden md:block"},ae={class:"container mx-auto px-4 py-12"},le={class:"max-w-2xl mx-auto mb-12"},ne={key:0,class:"mt-4 text-center"},de={class:"text-gray-600"},ce={class:"font-bold text-primea-blue"},ue={class:"mb-12"},me={class:"flex flex-wrap justify-center gap-4"},pe=["onClick"],ge={key:0,class:"mb-16"},he={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8"},xe={key:1,class:"mb-16"},fe={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 opacity-75"},be={key:2,class:"text-center py-20"},ye={class:"bg-white rounded-primea-xl shadow-primea-lg p-12"},ve={class:"mb-6"},_e={key:0},we={class:"text-gray-600 mb-6"},ke={key:1},Ce={class:"md:hidden"},Ee={class:"max-w-md mx-auto px-4 py-8"},Me={class:"mb-6"},Se={key:0,class:"mt-3 text-center"},Le={class:"text-gray-800 text-sm"},Te={class:"font-bold text-primea-blue"},je={class:"mb-6"},Be={class:"flex flex-wrap gap-2"},qe=["onClick"],ze={key:0,class:"mb-8"},De={class:"space-y-4"},Pe=["onClick"],Ne={class:"h-48 bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 relative overflow-hidden"},Ie=["src","alt"],Re={class:"absolute inset-0 p-4 text-white"},Ve={class:"flex justify-between items-start mb-4"},Ae={class:"text-xs"},Fe={class:"bg-primea-yellow/20 backdrop-blur-sm rounded-primea px-2 py-1 mb-1 text-primea-yellow font-bold uppercase"},Qe={class:"font-bold"},Xe={class:"text-right text-xs"},He={class:"bg-primea-yellow text-primea-blue px-2 py-1 rounded-primea mb-1 font-bold"},Oe={key:0,class:"bg-red-600 text-white px-2 py-1 rounded-primea font-bold"},Ge={class:"absolute bottom-4 left-4 right-4"},Ue={class:"flex justify-between items-end gap-2"},We={class:"text-xs flex-1"},Ye={class:"flex space-x-2 mb-2"},Ze={key:0,class:"bg-green-500 text-white px-2 py-1 rounded-primea text-xs font-bold"},Je={key:1,class:"bg-primea-blue text-white px-2 py-1 rounded-primea text-xs font-bold"},Ke={class:"text-xs text-gray-200"},$e=["onClick"],et={key:1,class:"mb-8"},tt={class:"space-y-4 opacity-75"},ot=["onClick"],rt={class:"h-48 bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 relative overflow-hidden"},st=["src","alt"],it={class:"absolute inset-0 p-4 text-white"},at={class:"flex justify-between items-start mb-4"},lt={class:"text-xs"},nt={class:"bg-primea-yellow/20 backdrop-blur-sm rounded-primea px-2 py-1 mb-1 text-primea-yellow font-bold uppercase"},dt={class:"font-bold"},ct={class:"text-right text-xs"},ut={class:"bg-primea-yellow text-primea-blue px-2 py-1 rounded-primea mb-1 font-bold"},mt={key:0,class:"bg-red-600 text-white px-2 py-1 rounded-primea font-bold"},pt={class:"absolute bottom-4 left-4 right-4"},gt={class:"flex justify-between items-end gap-2"},ht={class:"text-xs flex-1"},xt={class:"flex space-x-2 mb-2"},ft={key:0,class:"bg-green-500 text-white px-2 py-1 rounded-primea text-xs font-bold"},bt={key:1,class:"bg-primea-blue text-white px-2 py-1 rounded-primea text-xs font-bold"},yt={class:"text-xs text-gray-200"},vt=["onClick"],_t={key:2,class:"text-center py-12"},wt={key:0,class:"text-red-400 mb-4"},kt={class:"text-sm"},Ct={key:1,class:"text-white/80 mb-4"};function Et(v,r,L,o,M,g){const _=j("EventCard"),m=j("ExclamationTriangleIcon"),C=j("router-link");return a(),n("div",se,[t("div",ie,[t("div",ae,[t("div",le,[t("form",{onSubmit:r[1]||(r[1]=S((...e)=>o.performSearch&&o.performSearch(...e),["prevent"])),class:"relative"},[z(t("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=e=>o.searchQuery=e),placeholder:"Rechercher un événement par titre, lieu, organisateur...",class:"w-full px-6 py-4 rounded-primea-lg text-lg bg-white text-primea-blue placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primea-yellow shadow-primea border-2 border-transparent focus:border-primea-yellow transition-all"},null,512),[[D,o.searchQuery]]),r[8]||(r[8]=t("button",{type:"submit",class:"absolute right-3 top-1/2 transform -translate-y-1/2 bg-primea-yellow text-primea-blue p-3 rounded-primea hover:bg-primea-blue hover:text-white transition-all duration-200 shadow-primea"},[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))],32),o.searchQuery&&o.searchQuery.trim()?(a(),n("div",ne,[t("p",de,[r[9]||(r[9]=y(" Résultats pour: ",-1)),t("span",ce,'"'+d(o.searchQuery)+'"',1),t("button",{onClick:r[2]||(r[2]=(...e)=>o.clearSearch&&o.clearSearch(...e)),class:"ml-2 text-primea-yellow hover:text-primea-blue font-semibold"}," ✕ Effacer ")])])):u("",!0)]),t("div",ue,[r[10]||(r[10]=t("h2",{class:"text-2xl font-bold text-primea-blue text-center mb-8"}," Filtrer par catégorie ",-1)),t("div",me,[(a(!0),n(w,null,k(o.categories,e=>(a(),n("button",{key:e.id,onClick:f=>o.filterByCategory(e.id),class:P(["px-10 py-4 rounded-primea-lg text-lg font-bold transition-all duration-200 transform hover:scale-105 shadow-primea border-2",o.selectedCategory===e.id?"bg-primea-blue text-white border-primea-blue shadow-primea-lg scale-105":"bg-white text-primea-blue border-primea-blue hover:bg-primea-blue hover:text-white"])},d(e.name),11,pe))),128))])]),o.filteredEvents.length>0?(a(),n("div",ge,[r[11]||(r[11]=t("h2",{class:"text-2xl font-bold text-primea-blue mb-8"},"Événements à venir",-1)),t("div",he,[(a(!0),n(w,null,k(o.filteredEvents,e=>(a(),N(_,{key:e.id,event:e,class:"transform hover:scale-105 transition-all duration-300"},null,8,["event"]))),128))])])):u("",!0),o.pastEvents.length>0?(a(),n("div",xe,[r[12]||(r[12]=t("h2",{class:"text-2xl font-bold text-gray-600 mb-8 flex items-center gap-2"},[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),y(" Événements passés ")],-1)),t("div",fe,[(a(!0),n(w,null,k(o.pastEvents,e=>(a(),N(_,{key:e.id,event:e,class:"transform hover:scale-105 transition-all duration-300 grayscale hover:grayscale-0"},null,8,["event"]))),128))])])):u("",!0),o.filteredEvents.length===0&&!o.loading?(a(),n("div",be,[t("div",ye,[t("div",ve,[I(m,{class:"w-16 h-16 text-primea-blue/40 mx-auto"})]),o.eventsStore.error?(a(),n("div",_e,[r[13]||(r[13]=t("p",{class:"text-red-600 mb-4 text-xl font-semibold"},"⚠️ Erreur de connexion",-1)),t("p",we,d(o.eventsStore.error),1),t("button",{onClick:r[3]||(r[3]=(...e)=>o.loadEvents&&o.loadEvents(...e)),class:"bg-primea-blue text-white px-8 py-3 rounded-primea-lg font-bold hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200 shadow-primea"}," Réessayer ")])):(a(),n("div",ke,[r[14]||(r[14]=t("p",{class:"text-primea-blue mb-6 text-xl font-semibold"},"Aucun événement trouvé pour cette catégorie.",-1)),t("button",{onClick:r[4]||(r[4]=e=>o.filterByCategory("all")),class:"bg-primea-yellow text-primea-blue px-8 py-3 rounded-primea-lg font-bold hover:bg-primea-blue hover:text-white transition-all duration-200 shadow-primea"}," Voir tous les événements ")]))])])):u("",!0)])]),t("div",Ce,[t("div",Ee,[t("div",Me,[t("form",{onSubmit:r[6]||(r[6]=S((...e)=>o.performSearch&&o.performSearch(...e),["prevent"])),class:"relative"},[z(t("input",{type:"text","onUpdate:modelValue":r[5]||(r[5]=e=>o.searchQuery=e),placeholder:"Rechercher un événement...",class:"w-full px-4 py-3 rounded-primea-lg bg-white text-primea-blue placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primea-yellow"},null,512),[[D,o.searchQuery]]),r[15]||(r[15]=t("button",{type:"submit",class:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-primea-yellow text-primea-blue p-2 rounded-primea"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))],32),o.searchQuery&&o.searchQuery.trim()?(a(),n("div",Se,[t("p",Le,[r[16]||(r[16]=y(" Résultats pour: ",-1)),t("span",Te,'"'+d(o.searchQuery)+'"',1),t("button",{onClick:r[7]||(r[7]=(...e)=>o.clearSearch&&o.clearSearch(...e)),class:"ml-2 text-primea-yellow hover:text-primea-blue font-semibold"}," ✕ ")])])):u("",!0)]),t("div",je,[r[17]||(r[17]=t("h3",{class:"text-gray-800 text-sm font-bold mb-3"},"Catégories",-1)),t("div",Be,[(a(!0),n(w,null,k(o.categories,e=>(a(),n("button",{key:e.id,onClick:f=>o.filterByCategory(e.id),class:P(["px-4 py-2 rounded-primea text-sm font-bold transition-all duration-200",o.selectedCategory===e.id?"bg-primea-yellow text-primea-blue":"bg-white text-primea-blue border-2 border-primea-blue hover:bg-primea-yellow hover:text-primea-blue"])},d(e.name),11,qe))),128))])]),o.filteredEvents.length>0?(a(),n("div",ze,[r[20]||(r[20]=t("h3",{class:"text-gray-800 text-lg font-bold mb-4"},"Événements à venir",-1)),t("div",De,[(a(!0),n(w,null,k(o.filteredEvents,e=>(a(),n("div",{key:e.id,onClick:f=>o.goToEvent(e),class:"bg-white rounded-primea-lg shadow-primea overflow-hidden cursor-pointer hover:shadow-primea-lg transition-all duration-300 transform hover:scale-105"},[t("div",Ne,[e.image||e.image_url||e.image_file?(a(),n("img",{key:0,src:e.image_url||e.image||e.image_file,alt:e.title,class:"w-full h-full object-cover"},null,8,Ie)):u("",!0),r[19]||(r[19]=t("div",{class:"absolute inset-0 bg-primea-blue/40"},null,-1)),t("div",Re,[t("div",Ve,[t("div",Ae,[t("div",Fe,d(e.category?.name||e.category_name||"ÉVÉNEMENT"),1),t("div",Qe,d(e.title),1)]),t("div",Xe,[t("div",He,d(o.formatEventDate(e.event_date||e.date)),1),e.min_age?(a(),n("div",Oe,d(e.min_age)+"+",1)):u("",!0)])]),t("div",Ge,[t("div",Ue,[t("div",We,[t("div",Ye,[e.min_price&&e.min_price>0?(a(),n("div",Ze,d(o.formatPrice(e.min_price))+" XAF ",1)):u("",!0),e.max_price&&e.max_price>0&&e.max_price!==e.min_price?(a(),n("div",Je,d(o.formatPrice(e.max_price))+" XAF ",1)):u("",!0)]),t("div",Ke,d(e.venue?.name||e.venue_name||"Lieu à confirmer"),1)]),o.isEventPast(e)?u("",!0):(a(),n("button",{key:0,onClick:S(f=>v.$router.push(`/checkout/${e.slug}`),["stop"]),class:"ticket-btn-animate bg-yellow-500 text-blue-950 px-3 py-2 rounded-lg text-xs font-bold hover:bg-yellow-400 transition-colors flex items-center gap-1 shadow-lg flex-shrink-0"},[...r[18]||(r[18]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})],-1),y(" Prendre un ticket ",-1)])],8,$e))])])])])],8,Pe))),128))])])):u("",!0),o.pastEvents.length>0?(a(),n("div",et,[r[23]||(r[23]=t("h3",{class:"text-gray-600 text-lg font-bold mb-4 flex items-center gap-2"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),y(" Événements passés ")],-1)),t("div",tt,[(a(!0),n(w,null,k(o.pastEvents,e=>(a(),n("div",{key:e.id,onClick:f=>o.goToEvent(e),class:"bg-white rounded-primea-lg shadow-primea overflow-hidden cursor-pointer hover:shadow-primea-lg transition-all duration-300 transform hover:scale-105 grayscale hover:grayscale-0"},[t("div",rt,[e.image||e.image_url||e.image_file?(a(),n("img",{key:0,src:e.image_url||e.image||e.image_file,alt:e.title,class:"w-full h-full object-cover"},null,8,st)):u("",!0),r[22]||(r[22]=t("div",{class:"absolute inset-0 bg-primea-blue/40"},null,-1)),t("div",it,[t("div",at,[t("div",lt,[t("div",nt,d(e.category?.name||e.category_name||"ÉVÉNEMENT"),1),t("div",dt,d(e.title),1)]),t("div",ct,[t("div",ut,d(o.formatEventDate(e.event_date||e.date)),1),e.min_age?(a(),n("div",mt,d(e.min_age)+"+",1)):u("",!0)])]),t("div",pt,[t("div",gt,[t("div",ht,[t("div",xt,[e.min_price&&e.min_price>0?(a(),n("div",ft,d(o.formatPrice(e.min_price))+" XAF ",1)):u("",!0),e.max_price&&e.max_price>0&&e.max_price!==e.min_price?(a(),n("div",bt,d(o.formatPrice(e.max_price))+" XAF ",1)):u("",!0)]),t("div",yt,d(e.venue?.name||e.venue_name||"Lieu à confirmer"),1)]),o.isEventPast(e)?u("",!0):(a(),n("button",{key:0,onClick:S(f=>v.$router.push(`/checkout/${e.slug}`),["stop"]),class:"ticket-btn-animate bg-yellow-500 text-blue-950 px-3 py-2 rounded-lg text-xs font-bold hover:bg-yellow-400 transition-colors flex items-center gap-1 shadow-lg flex-shrink-0"},[...r[21]||(r[21]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})],-1),y(" Prendre un ticket ",-1)])],8,vt))])])])])],8,ot))),128))])])):u("",!0),o.filteredEvents.length===0&&!o.loading?(a(),n("div",_t,[o.eventsStore.error?(a(),n("div",wt,[r[24]||(r[24]=t("div",{class:"text-lg font-semibold mb-2"},"⚠️ Erreur de connexion",-1)),t("div",kt,d(o.eventsStore.error),1)])):(a(),n("div",Ct,"Aucun événement disponible pour le moment.")),I(C,{to:"/",class:"text-primea-yellow hover:text-white font-medium"},{default:Y(()=>[...r[25]||(r[25]=[y(" ← Retourner à l'accueil ",-1)])]),_:1})])):u("",!0)])])])}const qt=oe(re,[["render",Et],["__scopeId","data-v-aae83875"]]);export{qt as default};
