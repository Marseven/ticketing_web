import{H as N,J as U,r as L,c as f,b as d,i as C,d as u,e as r,g as y,q as E,t as l,j as D,A as _,n as S,N as F}from"./vue-vendor-DL4qlPdi.js";import{_ as B,C as A}from"./account-Pz60sx54.js";const V={name:"EventCard",components:{CalendarIcon:A,ClockIcon:U,MapPinIcon:N},props:{event:{type:Object,required:!0}},setup(n){const o=F(),i=L(!1),t=f(()=>{if(i.value)return null;let e=n.event.image||n.event.image_url||n.event.image_file;if(console.log("EventCard - Image URL pour:",n.event.title,"Image:",e),!e||e.trim()==="")return console.log("EventCard - Aucune image trouvée"),null;if(e.startsWith("http://")||e.startsWith("https://"))return console.log("EventCard - URL complète détectée:",e),e;if(e.startsWith("/")){const a=window.location.origin+e;return console.log("EventCard - Chemin relatif converti:",a),a}if(!e.includes("/")){const a=`${window.location.origin}/storage/images/events/${e}`;return console.log("EventCard - Nom de fichier converti:",a),a}return console.log("EventCard - URL retournée telle quelle:",e),e}),b=f(()=>{let e=null;if(n.event.schedules&&n.event.schedules.length>0&&(e=n.event.schedules[0].starts_at),!e&&n.event.next_schedule&&(e=n.event.next_schedule.starts_at),!e)return null;try{let a;if(e.includes("T")||e.includes("Z"))a=new Date(e);else if(e.includes("/")){const[m,v]=e.split(" "),[c,k,w]=m.split("/");a=new Date(`${w}-${k.padStart(2,"0")}-${c.padStart(2,"0")}T${v||"00:00:00"}`)}else if(e.includes("-")){const m=e.replace(" ","T");a=new Date(m)}else a=new Date(e);return isNaN(a.getTime())?(console.warn("Date invalide pour l'événement:",n.event.title,"Date reçue:",e),null):a}catch(a){return console.error("Erreur lors du parsing de la date:",a,"Date reçue:",e),null}}),T=f(()=>{if(n.event.min_price!==void 0&&n.event.min_price!==null&&n.event.min_price>0)return n.event.min_price;const e=n.event.ticket_types||n.event.ticketTypes;if(e&&e.length>0){const a=e.map(m=>{const v=parseFloat(m.price);return isNaN(v)?0:v}).filter(m=>m>0);if(a.length>0)return Math.min(...a)}return 0}),g=f(()=>b.value?new Date>b.value:!1),h=f(()=>{if(g.value)return 0;const e=n.event.ticket_types||n.event.ticketTypes;if(e&&e.length>0){const a=e.reduce((v,c)=>{if(c.remaining_quantity!==void 0&&c.remaining_quantity!==null)return v+Math.max(0,c.remaining_quantity);if(c.available_quantity!==void 0&&c.available_quantity!==null){const z=c.sold_quantity||0;return v+Math.max(0,c.available_quantity-z)}const k=c.quantity||0,w=c.sold_quantity||c.sold||0;return v+Math.max(0,k-w)},0);return e.some(v=>v.available_quantity!==null&&v.available_quantity!==void 0)?a:1e3}return 1e3}),x=f(()=>g.value?"Événement passé":h.value===0?"Complet":"Acheter un ticket"),s=f(()=>!g.value&&h.value>0),P=e=>e?e.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"Date à confirmer",q=e=>e?e.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"--:--",M=e=>new Intl.NumberFormat("fr-FR").format(e),R=(e,a)=>!e||typeof e!="string"?"":e.length<=a?e:e.substr(0,a).trim()+"...",j=()=>{o.push(`/events/${n.event.slug}`)},I=()=>{console.log("goToCheckout called with event:",n.event),console.log("Event slug:",n.event.slug);let e=n.event.slug;if(!e)if(n.event.id)e={1:"concert-jazz-etoiles",2:"oiseau-rare",3:"festival-arts-culture"}[n.event.id]||`event-${n.event.id}`;else if(n.event.title)e=n.event.title.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-").slice(0,50);else{console.error("Event slug, ID and title are all missing!",n.event),alert("Erreur: Impossible de réserver - informations manquantes");return}console.log("Using slug:",e),o.push(`/checkout/${e}`)};return{eventImageUrl:t,eventDate:b,minPrice:T,isEventPassed:g,availableTickets:h,buttonText:x,canPurchase:s,formatDate:P,formatTime:q,formatPrice:M,truncateText:R,goToEvent:j,goToCheckout:I,handleReserveClick:e=>{if(console.log("handleReserveClick called"),e.preventDefault(),e.stopPropagation(),!s.value){console.log("Cannot purchase - button disabled");return}I()},handleImageError:e=>{console.warn("EventCard - Erreur de chargement image pour:",n.event.title),console.warn("EventCard - URL qui a échoué:",e?.target?.src),i.value=!0}}}},W={class:"event-image"},Q=["src","alt"],G={key:1,class:"w-full h-full bg-gradient-to-br from-blue-100 to-yellow-100 flex items-center justify-center"},H={key:2,class:"absolute top-4 left-4"},J={class:"bg-yellow-400 primea-text-blue px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide"},O={class:"absolute bottom-4 right-4 bg-black/70 backdrop-blur-sm rounded-lg px-3 py-2 text-white"},Z={key:0},K={class:"text-lg font-bold"},X={key:1,class:"text-lg font-bold text-green-400"},Y={class:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center"},p={class:"p-6"},$={class:"flex items-center gap-4 mb-3 text-sm text-gray-500"},ee={class:"flex items-center gap-1"},te={class:"flex items-center gap-1"},ne={class:"font-bold text-xl primea-text-blue mb-2 line-clamp-2"},re={class:"flex items-center gap-1 mb-3 text-gray-600"},ae={key:0},oe={key:1},ie={key:2},le={class:"text-gray-600 text-sm mb-4 line-clamp-3"},se={class:"flex items-center justify-between"},ce={key:0,class:"text-gray-500 text-sm font-medium flex items-center gap-1"},de={key:1,class:"text-amber-600 text-sm font-medium flex items-center gap-1"},ue={key:2,class:"text-red-600 text-sm font-medium"},ve=["disabled"];function me(n,o,i,t,b,T){const g=E("CalendarIcon"),h=E("ClockIcon"),x=E("MapPinIcon");return i.event&&i.event.title?(u(),d("article",{key:0,class:"event-card-modern group cursor-pointer",onClick:o[4]||(o[4]=(...s)=>t.goToEvent&&t.goToEvent(...s))},[r("div",W,[t.eventImageUrl?(u(),d("img",{key:0,src:t.eventImageUrl,alt:i.event.title,loading:"lazy",class:"w-full h-full object-cover",onError:o[0]||(o[0]=(...s)=>t.handleImageError&&t.handleImageError(...s))},null,40,Q)):(u(),d("div",G,[y(g,{size:"2xl",class:"primea-text-gray-400"})])),i.event.category?.name||i.event.category_name?(u(),d("div",H,[r("span",J,l(i.event.category?.name||i.event.category_name||"Événement"),1)])):C("",!0),r("div",O,[t.minPrice>0?(u(),d("div",Z,[o[5]||(o[5]=r("div",{class:"text-xs text-gray-300"},"À partir de",-1)),r("div",K,l(t.formatPrice(t.minPrice))+" FCFA",1)])):(u(),d("div",X,"Gratuit"))]),r("div",Y,[r("button",{onClick:o[1]||(o[1]=D((...s)=>t.goToEvent&&t.goToEvent(...s),["stop"])),class:"bg-primea-yellow text-primea-blue px-6 py-3 rounded-primea-lg font-bold hover:bg-white hover:text-primea-blue transition-all duration-200 shadow-primea-lg transform translate-y-4 group-hover:translate-y-0 flex items-center"},[...o[6]||(o[6]=[r("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),_(" Voir détails ",-1)])])])]),r("div",p,[r("div",$,[r("div",ee,[y(g,{size:"sm"}),_(" "+l(t.formatDate(t.eventDate)),1)]),r("div",te,[y(h,{class:"w-4 h-4"}),_(" "+l(t.formatTime(t.eventDate)),1)])]),r("h3",ne,[r("button",{onClick:o[2]||(o[2]=(...s)=>t.goToEvent&&t.goToEvent(...s)),class:"hover:underline text-left"},l(i.event.title),1)]),r("div",re,[y(x,{class:"w-4 h-4"}),i.event.venue?(u(),d("span",ae,l(i.event.venue.name)+", "+l(i.event.venue.city),1)):i.event.venue_name?(u(),d("span",oe,l(i.event.venue_name)+", "+l(i.event.venue_city),1)):(u(),d("span",ie,"Lieu à confirmer"))]),r("p",le,l(t.truncateText(i.event.description,120)),1),r("div",se,[r("div",null,[t.isEventPassed?(u(),d("div",ce,[...o[7]||(o[7]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),_(" Événement terminé ",-1)])])):t.availableTickets<20&&t.availableTickets>0?(u(),d("div",de,[o[8]||(o[8]=r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),_(" "+l(t.availableTickets)+" place"+l(t.availableTickets>1?"s":"")+" restante"+l(t.availableTickets>1?"s":""),1)])):t.availableTickets===0&&!t.isEventPassed?(u(),d("div",ue,"Complet")):C("",!0)]),r("button",{onClick:o[3]||(o[3]=D((...s)=>t.handleReserveClick&&t.handleReserveClick(...s),["stop"])),class:S(["px-6 py-2 rounded-primea text-sm font-bold transition-all duration-200 font-primea shadow-primea border-2",t.canPurchase?"bg-primea-blue text-white hover:bg-primea-yellow hover:text-primea-blue transform hover:scale-105 border-primea-blue hover:border-primea-yellow":t.isEventPassed?"bg-gray-400 text-white cursor-not-allowed border-gray-400":"bg-red-500 text-white cursor-not-allowed border-red-500"]),disabled:!t.canPurchase},l(t.buttonText),11,ve)])])])):C("",!0)}const be=B(V,[["render",me],["__scopeId","data-v-4f8f9b55"]]);export{be as E};
