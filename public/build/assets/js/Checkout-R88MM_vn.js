import{ar as Se,aw as Pe,aA as Ee,J as Ie,H as Ce,Z as Me,D as Ne,g as l,o as i,h as t,l as x,j as b,a as E,k as L,t as c,A,p as qe,i as B,v as H,L as Fe,F as Te,q as Ae,n as G,$ as Ve,U as je,d as _,b as v,e as De,f as Re,B as Ue,N as Oe}from"./vue-vendor-CGc-1SHl.js";import{u as Le}from"./app-yTyL_ORP.js";import{_ as Be,P as ze,u as We,b as ne,g as se}from"./account-D9D2Jch1.js";import"./vendor-BvANJOFB.js";/* empty css            */import"./pinia-vendor-C7xpF7iQ.js";const Je={name:"Checkout",components:{PhoneInput:ze,ExclamationCircleIcon:Ne,PhotoIcon:Me,MapPinIcon:Ce,ClockIcon:Ie,ArrowTopRightOnSquareIcon:Ee,ChevronLeftIcon:Pe,Bars3Icon:Se},setup(){const Q=Ue(),e=Oe(),X=Le(),o=We(),h=_(()=>o.isAuthenticated),k=_(()=>o.user),s=v(null),S=v(!0),I=v(""),F=v(!1),P=v(""),C=v(""),M=v(null),V=v(new Date),D=v({days:0,hours:0,minutes:0,seconds:0}),a=v(!1),T=v(90),f=v(null),w=v(null),N=v(""),y=v(null),q=v(null),n=v({quantity:1,ticketTypeId:"",paymentMethod:"",phoneNumber:"",cardNumber:"",expiryDate:"",cvv:"",guestName:"",guestPhone:""}),Z=v(!1),le=_(()=>{if(Z.value||!s.value)return null;let r=s.value.image||s.value.image_url||s.value.image_file;return console.log("Checkout - Image URL:",r),!r||r.trim()===""?null:r.startsWith("http://")||r.startsWith("https://")?r:r.startsWith("/")?window.location.origin+r:r.includes("/")?r:`${window.location.origin}/storage/images/events/${r}`}),ie=_(()=>!s.value?.schedules||s.value.schedules.length===0?"Date à confirmer":new Date(s.value.schedules[0].starts_at).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}).toUpperCase()),de=_(()=>!s.value?.schedules||s.value.schedules.length===0?"Heure à confirmer":new Date(s.value.schedules[0].starts_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})),j=_(()=>!s.value?.schedules||s.value.schedules.length===0?null:new Date(s.value.schedules[0].starts_at)),R=_(()=>j.value?new Date>j.value:!1),z=_(()=>{if(!j.value)return null;const r=j.value.getTime()-V.value.getTime();if(r<=0)return{days:0,hours:0,minutes:0,seconds:0,expired:!0};const d=Math.floor(r/(1e3*60*60*24)),p=Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),u=Math.floor(r%(1e3*60*60)/(1e3*60)),g=Math.floor(r%(1e3*60)/1e3);return{days:d,hours:p,minutes:u,seconds:g,expired:!1}}),W=_(()=>!s.value?.ticket_types||R.value?[]:s.value.ticket_types.filter(r=>{if(r.remaining_quantity!==void 0&&r.remaining_quantity!==null)return r.remaining_quantity>0;if(r.available_quantity!==void 0&&r.available_quantity!==null){const d=r.sold_quantity||0;return r.available_quantity-d>0}return r.available_quantity===null?!0:r.quantity-(r.sold||0)>0})),ue=_(()=>!R.value&&W.value.length>0),U=_(()=>{if(!n.value.quantity||!n.value.ticketTypeId)return 0;const r=W.value.find(d=>d.id==n.value.ticketTypeId);return r?r.price*n.value.quantity:0}),Y=_(()=>!n.value.quantity||!n.value.ticketTypeId||!n.value.paymentMethod||!h.value&&!n.value.guestName?!1:n.value.paymentMethod==="airtel"||n.value.paymentMethod==="moov"?!!n.value.phoneNumber&&!C.value:(n.value.paymentMethod==="visa",!0)),ce=r=>new Intl.NumberFormat("fr-FR").format(r),me=r=>{if(r.remaining_quantity!==void 0&&r.remaining_quantity!==null)return r.remaining_quantity>0?`${r.remaining_quantity} disponibles`:"Épuisé";if(r.available_quantity===null)return"Illimité";if(r.available_quantity!==void 0&&r.available_quantity!==null){const p=r.available_quantity-(r.sold_quantity||0);return p>0?`${p} disponibles`:"Épuisé"}const d=r.quantity-(r.sold||0);return d>0?`${d} disponibles`:"Épuisé"},ve=()=>s.value?s.value.category&&typeof s.value.category=="object"&&s.value.category.name?s.value.category.name.toUpperCase():s.value.category&&typeof s.value.category=="string"?s.value.category.toUpperCase():s.value.category_name&&typeof s.value.category_name=="string"?s.value.category_name.toUpperCase():"ÉVÉNEMENT":"ÉVÉNEMENT",$=async()=>{const r=Q.params.eventSlug;if(!r){I.value="ID d'événement manquant",S.value=!1;return}try{S.value=!0,I.value="";const d=await X.fetchEvent(r);s.value=d.event,s.value?.ticket_types&&s.value.ticket_types.length===1&&(n.value.ticketTypeId=s.value.ticket_types[0].id),pe()}catch(d){I.value=d.message||"Erreur lors du chargement de l'événement"}finally{S.value=!1}},ee=()=>{const r=z.value;r&&(D.value={days:r.days,hours:r.hours,minutes:r.minutes,seconds:r.seconds})},pe=()=>{M.value&&clearInterval(M.value),V.value=new Date,ee(),M.value=setInterval(()=>{V.value=new Date,ee(),z.value?.expired&&clearInterval(M.value)},1e3),console.log("Checkout - Compte à rebours démarré")},be=()=>{const r=n.value.phoneNumber,d=n.value.paymentMethod;if(C.value="",!!r){if(d==="airtel"){const p=["074","076","077"];r.length===9&&/^[0-9]+$/.test(r)&&p.some(g=>r.startsWith(g))||(C.value="Le numéro Airtel Money doit faire 9 chiffres et commencer par 074, 076 ou 077")}if(d==="moov"){const p=["060","062","065","066"];r.length===9&&/^[0-9]+$/.test(r)&&p.some(g=>r.startsWith(g))||(C.value="Le numéro Moov Money doit faire 9 chiffres et commencer par 060, 062, 065 ou 066")}}},ye=r=>{n.value.paymentMethod=r,n.value.phoneNumber="",n.value.cardNumber="",n.value.expiryDate="",n.value.cvv="",C.value=""},ge=async()=>{try{if(F.value=!0,P.value="",R.value)throw new Error("Impossible d'acheter des tickets pour un événement terminé");if(!Y.value)throw new Error("Veuillez remplir tous les champs requis");if(n.value.paymentMethod==="airtel"||n.value.paymentMethod==="moov")await te();else if(n.value.paymentMethod==="visa")await oe();else throw new Error("Méthode de paiement non supportée")}catch(r){if(console.error("Erreur lors du processus d'achat:",r),r.response?.data?.message)P.value=r.response.data.message;else if(r.response?.data?.errors){const d=r.response.data.errors,p=[];for(const[u,g]of Object.entries(d)){const m={guest_name:"Nom complet",guest_email:"Email",guest_phone:"Téléphone",ticket_type_id:"Type de ticket",quantity:"Quantité",phone:"Numéro de téléphone",amount:"Montant"}[u]||u;g.forEach(O=>{O==="validation.required"?p.push(`Le champ ${m} est requis`):p.push(O)})}P.value=p.join(". ")}else P.value=r.message||"Erreur lors du traitement de l'achat"}finally{F.value=!1}},te=async()=>{try{let r;if(q.value)r=q.value,console.log("♻️ Réutilisation de la commande existante:",r.reference);else{const g={event_slug:s.value.slug,ticket_type_id:n.value.ticketTypeId,quantity:n.value.quantity,guest_name:h.value?k.value.name:n.value.guestName,guest_phone:h.value?k.value.phone:n.value.guestPhone||null,guest_email:h.value?k.value.email:"guest@primea.ga"},m=h.value?await ne.createOrder(g):await se.createGuestOrder(g);if(!m.data.success)throw new Error(m.data.message||"Erreur lors de la création de l'achat");r=m.data.data.order,q.value=r,console.log("✅ Nouvelle commande créée:",r.reference)}const d={order_id:r.id,gateway:n.value.paymentMethod==="airtel"?"airtelmoney":"moovmoney",phone:n.value.phoneNumber,amount:U.value},u=await(await fetch("/api/v1/payments/initiate",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify(d)})).json();if(!u.success)throw new Error(u.message||"Erreur lors de l'initiation du paiement");if(u.data?.bill_id){const m=await(await fetch("/api/v1/payments/push-ussd",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify({payment_id:u.data.payment.id,bill_id:u.data.bill_id,phone:n.value.phoneNumber,gateway:n.value.paymentMethod==="airtel"?"airtelmoney":"moovmoney"})})).json();if(m.success)re({payment_id:u.data.payment.id,reference:r.reference,phone:n.value.phoneNumber,gateway:n.value.paymentMethod==="airtel"?"airtelmoney":"moovmoney",amount:U.value,bill_id:u.data.bill_id,payment_url:u.data.payment_url});else{console.error("❌ Push USSD échoué:",{message:m.message,error_code:m.error_code,details:m.details,payment_id:u.data.payment.id,bill_id:u.data.bill_id,phone:n.value.phoneNumber,gateway:n.value.paymentMethod});const O=m.details?`${m.message}
Détails: ${m.details}`:m.message||"Erreur lors de l'envoi du push USSD";throw new Error(O)}}else throw new Error("Erreur lors de la création de la facture E-Billing")}catch(r){throw console.error("Erreur E-Billing:",r),r}},oe=async()=>{try{let r;if(q.value)r=q.value,console.log("♻️ Réutilisation de la commande existante:",r.reference);else{const g={event_slug:s.value.slug,ticket_type_id:n.value.ticketTypeId,quantity:n.value.quantity,guest_name:h.value?k.value.name:n.value.guestName,guest_phone:h.value?k.value.phone:n.value.guestPhone||null,guest_email:h.value?k.value.email:"guest@primea.ga"},m=h.value?await ne.createOrder(g):await se.createGuestOrder(g);if(!m.data.success)throw new Error(m.data.message||"Erreur lors de la création de l'achat");r=m.data.data.order,q.value=r,console.log("✅ Nouvelle commande créée:",r.reference)}const d={order_id:r.id,gateway:"ORABANK_NG",amount:U.value},u=await(await fetch("/api/v1/payments/initiate",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify(d)})).json();if(u.success&&u.data?.redirect_url)window.location.href=u.data.redirect_url;else throw new Error(u.message||"Erreur lors de l'initiation du paiement Visa/Mastercard")}catch(r){throw console.error("Erreur ORABANK:",r),r}},xe=()=>{e.back()},re=r=>{a.value=!0,T.value=90,N.value="pending",y.value=r,J(),K(r.payment_id)},J=()=>{f.value&&clearInterval(f.value),f.value=setInterval(()=>{T.value--,T.value<=0&&(clearInterval(f.value),clearInterval(w.value),N.value="expired")},1e3)},K=r=>{w.value&&clearInterval(w.value),w.value=setInterval(async()=>{try{const d=await fetch(`/api/v1/payments/${r}/status`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`}});if(d.ok){const u=(await d.json()).data?.payment?.status;u==="success"||u==="successful"?(N.value="successful",clearInterval(w.value),clearInterval(f.value),setTimeout(()=>{e.push(`/ticket-success?reference=${y.value.reference}`)},2e3)):(u==="failed"||u==="cancelled"||u==="expired")&&(N.value=u,clearInterval(w.value),clearInterval(f.value),setTimeout(()=>{ae()},3e3))}}catch(d){console.error("Erreur lors de la vérification du statut:",d)}},3e3)},ae=()=>{a.value=!1,T.value=90,N.value="",y.value=null,q.value=null,f.value&&clearInterval(f.value),w.value&&clearInterval(w.value)},he=async()=>{if(y.value)try{F.value=!0;const r=await fetch("/api/v1/payments/push-ussd",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify({payment_id:y.value.payment_id,phone:y.value.phone,gateway:y.value.gateway})});if(r.ok)T.value=90,N.value="pending",J(),K(y.value.payment_id);else{const d=await r.json();P.value=d.message||"Erreur lors du renvoi du push"}}catch{P.value="Erreur de connexion"}finally{F.value=!1}},fe=()=>{if(!y.value?.payment_url||!y.value?.bill_id){console.error("URL de paiement manquante");return}const r=`${y.value.payment_url}?invoice=${y.value.bill_id}`;window.location.href=r},we=()=>{a.value=!1,T.value=90,N.value="",y.value=null,f.value&&clearInterval(f.value),w.value&&clearInterval(w.value),n.value.paymentMethod="",n.value.phoneNumber="",console.log("🔄 Changement d'opérateur - Commande conservée:",q.value?.reference)},_e=r=>{const d=Math.floor(r/60),p=r%60;return`${d}:${p.toString().padStart(2,"0")}`},ke=r=>r?r.replace(/(\d{3})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4"):"";return De(()=>{$(),h.value&&k.value&&(n.value.guestName=k.value.name||"",n.value.guestPhone=k.value.phone||"")}),Re(()=>{M.value&&clearInterval(M.value),f.value&&clearInterval(f.value),w.value&&clearInterval(w.value)}),{isAuthenticated:h,currentUser:k,event:s,eventLoading:S,eventError:I,loading:F,error:P,phoneError:C,countdown:D,orderForm:n,totalAmount:U,isFormValid:Y,formatEventDate:ie,eventTime:de,eventDate:j,isEventPassed:R,timeUntilEvent:z,availableTicketTypes:W,canPurchaseTickets:ue,formatPrice:ce,getAvailableQuantityText:me,getCategoryName:ve,loadEvent:$,validatePhoneNumber:be,selectPaymentMethod:ye,processOrder:ge,goBack:xe,ussdPushActive:a,ussdCountdown:T,paymentStatus:N,currentPayment:y,startUSSDPush:re,startUSSDCountdown:J,startPaymentPolling:K,cancelUSSDPush:ae,retryUSSDPush:he,payViaWebPage:fe,changeOperator:we,formatCountdown:_e,formatPhoneForDisplay:ke,processEBillingPayment:te,processOrabankPayment:oe,eventImageUrl:le,handleImageError:()=>{console.warn("Checkout - Erreur de chargement de l'image"),Z.value=!0}}}},Ke={class:"checkout-page min-h-screen font-primea"},He={class:"hidden md:block bg-gray-50 min-h-screen"},Ge={class:"container mx-auto px-4 py-12"},Qe={class:"max-w-4xl mx-auto"},Xe={class:"mb-12"},Ze={class:"flex items-center justify-between mb-6"},Ye={key:0,class:"text-center py-8"},$e={key:1,class:"text-center py-8"},et={class:"bg-red-50 border border-red-200 rounded-primea-xl p-8"},tt={class:"text-red-600 mb-4"},ot={key:2,class:"grid grid-cols-1 lg:grid-cols-2 gap-12"},rt={class:"space-y-8"},at={class:"bg-white rounded-primea-xl shadow-primea overflow-hidden"},nt={class:"relative h-64"},st=["src","alt"],lt={key:1,class:"w-full h-full bg-primea-gradient flex items-center justify-center"},it={class:"absolute inset-0 p-6 text-white flex flex-col justify-end"},dt={class:"bg-primea-yellow text-primea-blue px-3 py-1 rounded-primea text-sm font-bold w-fit mb-2"},ut={class:"text-2xl font-bold mb-2"},ct={class:"text-white/90"},mt={class:"p-6"},vt={class:"space-y-3"},pt={class:"flex items-center gap-3"},bt={class:"text-gray-700"},yt={class:"flex items-center gap-3"},gt={class:"text-gray-700"},xt={class:"bg-white rounded-primea-xl shadow-primea p-6"},ht={class:"text-lg font-bold text-primea-blue mb-4 text-center"},ft={key:0,class:"text-center"},wt={class:"bg-red-50 border border-red-200 rounded-primea-lg p-4"},_t={key:1,class:"flex justify-center space-x-2"},kt={key:0,class:"text-center bg-gray-100 border-2 border-primea-blue rounded-primea-lg p-4 min-w-[70px]"},St={class:"text-2xl font-bold text-primea-blue"},Pt={class:"text-center bg-gray-100 border-2 border-primea-blue rounded-primea-lg p-4 min-w-[70px]"},Et={class:"text-2xl font-bold text-primea-blue"},It={class:"text-center bg-gray-100 border-2 border-primea-blue rounded-primea-lg p-4 min-w-[70px]"},Ct={class:"text-2xl font-bold text-primea-blue"},Mt={class:"text-center bg-gray-100 border-2 border-primea-blue rounded-primea-lg p-4 min-w-[70px]"},Nt={class:"text-2xl font-bold text-primea-blue"},qt={class:"bg-white rounded-primea-xl shadow-primea p-8"},Ft={class:"text-2xl font-bold text-primea-blue mb-6"},Tt={key:0,class:"bg-red-50 border border-red-200 rounded-primea-lg p-6 text-center"},At=["disabled"],Vt=["value"],jt={key:0,class:"text-sm text-red-600 mt-1"},Dt={key:0,class:"bg-primea-blue/5 rounded-primea-xl p-6 space-y-4"},Rt={key:1,class:"bg-primea-blue/5 rounded-primea-xl p-6"},Ut={class:"flex justify-between items-center"},Ot={class:"text-3xl font-bold text-primea-blue"},Lt={class:"grid grid-cols-3 gap-4 mb-6"},Bt={key:0},zt=["for"],Wt=["id","placeholder"],Jt={key:0,class:"mt-2 text-sm text-red-600"},Kt={key:1,class:"mt-2 text-sm text-gray-500"},Ht={key:1,class:"space-y-4"},Gt={class:"bg-blue-50 border border-blue-200 rounded-primea-lg p-4 text-center"},Qt=["disabled"],Xt={key:2,class:"bg-red-50 border-2 border-red-200 rounded-primea-lg p-4"},Zt={class:"text-red-600 text-sm"},Yt={key:3,class:"bg-blue-50 border-2 border-blue-200 rounded-primea-xl p-6"},$t={class:"text-center"},eo={key:0,class:"space-y-4"},to={class:"text-blue-700 mb-4"},oo={class:"font-semibold"},ro={class:"bg-white border border-blue-200 rounded-primea-lg p-4 mb-4"},ao={class:"text-3xl font-bold text-blue-600 mb-2"},no={class:"w-full bg-blue-200 rounded-full h-2 mt-3"},so={class:"text-blue-600 text-sm mb-4"},lo={class:"font-semibold"},io={class:"flex flex-col sm:flex-row gap-3 justify-center"},uo=["disabled"],co={key:0},mo={key:1},vo=["disabled"],po={key:1,class:"space-y-4"},bo={key:2,class:"space-y-4"},yo={class:"text-red-700 mb-4"},go={class:"flex flex-col sm:flex-row gap-3 justify-center"},xo=["disabled"],ho={key:0,class:"flex items-center justify-center"},fo={key:1},wo={class:"text-center pt-4"},_o={class:"md:hidden bg-gray-100 min-h-screen py-8 px-4"},ko={class:"max-w-md mx-auto"},So={class:"flex items-center justify-between mb-8"},Po={class:"text-gray-600"};function Eo(Q,e,X,o,h,k){const s=E("ChevronLeftIcon"),S=E("router-link"),I=E("ExclamationCircleIcon"),F=E("PhotoIcon"),P=E("MapPinIcon"),C=E("ClockIcon"),M=E("PhoneInput"),V=E("ArrowTopRightOnSquareIcon"),D=E("Bars3Icon");return i(),l("div",Ke,[t("div",He,[t("div",Ge,[t("div",Qe,[t("div",Xe,[t("div",Ze,[t("button",{onClick:e[0]||(e[0]=(...a)=>o.goBack&&o.goBack(...a)),class:"flex items-center text-primea-blue hover:text-primea-yellow transition-colors"},[b(s,{class:"w-6 h-6 mr-2"}),e[20]||(e[20]=t("span",{class:"font-medium"},"Retour",-1))]),b(S,{to:"/",class:"flex-1 flex justify-center"},{default:L(()=>[...e[21]||(e[21]=[t("img",{src:"/images/logo.png",alt:"Primea",class:"h-16 hover:opacity-80 transition-opacity cursor-pointer"},null,-1)])]),_:1}),e[22]||(e[22]=t("div",{class:"w-24"},null,-1))]),e[23]||(e[23]=t("div",{class:"text-center"},[t("h1",{class:"text-4xl font-bold text-primea-blue mb-4"},"Finaliser votre achat"),t("p",{class:"text-lg text-gray-600"},"Sélectionnez vos tickets et procédez au paiement")],-1))]),o.eventLoading?(i(),l("div",Ye,[...e[24]||(e[24]=[t("div",{class:"animate-spin rounded-full h-32 w-32 border-b-2 border-primea-blue mx-auto"},null,-1),t("p",{class:"mt-4 text-gray-600"},"Chargement de l'événement...",-1)])])):o.eventError?(i(),l("div",$e,[t("div",et,[b(I,{class:"w-16 h-16 text-red-500 mx-auto mb-4"}),e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-red-800 mb-2"},"Erreur de chargement",-1)),t("p",tt,c(o.eventError),1),t("button",{onClick:e[1]||(e[1]=(...a)=>o.loadEvent&&o.loadEvent(...a)),class:"bg-primea-blue text-white px-6 py-2 rounded-primea hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200"}," Réessayer ")])])):o.event?(i(),l("div",ot,[t("div",rt,[t("div",at,[t("div",nt,[o.eventImageUrl?(i(),l("img",{key:0,src:o.eventImageUrl,alt:o.event.title,class:"w-full h-full object-cover",onError:e[2]||(e[2]=(...a)=>o.handleImageError&&o.handleImageError(...a))},null,40,st)):(i(),l("div",lt,[b(F,{class:"w-24 h-24 text-white/50"})])),e[26]||(e[26]=t("div",{class:"absolute inset-0 bg-primea-blue/60"},null,-1)),t("div",it,[t("div",dt,c(o.getCategoryName()),1),t("h2",ut,c(o.event?.title||"Chargement..."),1),t("p",ct,c(o.formatEventDate),1)])]),t("div",mt,[t("div",vt,[t("div",pt,[b(P,{class:"w-5 h-5 text-primea-blue"}),t("span",bt,c(o.event?.venue_name||"Lieu à confirmer"),1)]),t("div",yt,[b(C,{class:"w-5 h-5 text-primea-blue"}),t("span",gt,c(o.eventTime),1)])])])]),t("div",xt,[t("h3",ht,c(o.isEventPassed?"Événement terminé":"Temps restant pour l'événement"),1),o.isEventPassed?(i(),l("div",ft,[t("div",wt,[b(I,{class:"w-12 h-12 text-red-500 mx-auto mb-2"}),e[27]||(e[27]=t("p",{class:"text-red-600 font-semibold"},"Cet événement est terminé",-1)),e[28]||(e[28]=t("p",{class:"text-red-500 text-sm"},"Les tickets ne sont plus disponibles",-1))])])):(i(),l("div",_t,[o.countdown.days>0?(i(),l("div",kt,[t("div",St,c(o.countdown.days),1),e[29]||(e[29]=t("div",{class:"text-xs text-gray-600"},"JOURS",-1))])):x("",!0),t("div",Pt,[t("div",Et,c(o.countdown.hours),1),e[30]||(e[30]=t("div",{class:"text-xs text-gray-600"},"HEURES",-1))]),t("div",It,[t("div",Ct,c(o.countdown.minutes),1),e[31]||(e[31]=t("div",{class:"text-xs text-gray-600"},"MIN",-1))]),t("div",Mt,[t("div",Nt,c(o.countdown.seconds),1),e[32]||(e[32]=t("div",{class:"text-xs text-gray-600"},"SEC",-1))])]))])]),t("div",qt,[t("h3",Ft,c(o.isEventPassed?"Achat impossible":"Votre achat"),1),o.isEventPassed?(i(),l("div",Tt,[b(I,{class:"w-16 h-16 text-red-500 mx-auto mb-4"}),e[34]||(e[34]=t("h4",{class:"text-lg font-semibold text-red-800 mb-2"},"Événement terminé",-1)),e[35]||(e[35]=t("p",{class:"text-red-600 mb-4"},"Cet événement s'est déjà déroulé. Il n'est plus possible d'acheter des tickets.",-1)),b(S,{to:"/events",class:"bg-primea-blue text-white px-6 py-2 rounded-primea hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200"},{default:L(()=>[...e[33]||(e[33]=[A(" Voir d'autres événements ",-1)])]),_:1})])):x("",!0),o.isEventPassed?x("",!0):(i(),l("form",{key:1,onSubmit:e[18]||(e[18]=qe((...a)=>o.processOrder&&o.processOrder(...a),["prevent"])),class:"space-y-6"},[t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-semibold text-primea-blue mb-3"},"Nombre de tickets",-1)),B(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=a=>o.orderForm.quantity=a),min:"1",max:"10",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-primea-lg focus:border-primea-blue focus:outline-none transition-colors",required:""},null,512),[[H,o.orderForm.quantity]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-semibold text-primea-blue mb-3"},"Type de ticket",-1)),B(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.orderForm.ticketTypeId=a),class:"w-full px-4 py-3 border-2 border-gray-200 rounded-primea-lg focus:border-primea-blue focus:outline-none transition-colors appearance-none bg-white",required:"",disabled:o.eventLoading||o.availableTicketTypes.length===0},[e[37]||(e[37]=t("option",{value:""},"Sélectionnez un type de ticket",-1)),(i(!0),l(Te,null,Ae(o.availableTicketTypes,a=>(i(),l("option",{key:a.id,value:a.id},c(a.name)+" - "+c(o.formatPrice(a.price))+" FCFA ("+c(o.getAvailableQuantityText(a))+") ",9,Vt))),128))],8,At),[[Fe,o.orderForm.ticketTypeId]]),o.availableTicketTypes.length===0&&!o.eventLoading?(i(),l("div",jt," Aucun ticket disponible pour cet événement ")):x("",!0)]),o.isAuthenticated?x("",!0):(i(),l("div",Dt,[e[41]||(e[41]=t("h4",{class:"text-lg font-semibold text-primea-blue mb-4"},"Vos informations",-1)),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-semibold text-primea-blue mb-2"},"Nom complet *",-1)),B(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=a=>o.orderForm.guestName=a),placeholder:"Votre nom complet",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-primea-lg focus:border-primea-blue focus:outline-none transition-colors",required:""},null,512),[[H,o.orderForm.guestName]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-semibold text-primea-blue mb-2"},"Téléphone (optionnel)",-1)),b(M,{modelValue:o.orderForm.guestPhone,"onUpdate:modelValue":e[6]||(e[6]=a=>o.orderForm.guestPhone=a),id:"guest-phone",placeholder:"01 23 45 67",class:"w-full"},null,8,["modelValue"])])])),o.orderForm.quantity&&o.orderForm.ticketTypeId?(i(),l("div",Rt,[t("div",Ut,[e[42]||(e[42]=t("span",{class:"text-lg font-semibold text-primea-blue"},"Total à payer :",-1)),t("span",Ot,c(o.formatPrice(o.totalAmount))+" FCFA",1)])])):x("",!0),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-semibold text-primea-blue mb-4"},"Moyen de paiement",-1)),t("div",Lt,[t("button",{type:"button",onClick:e[7]||(e[7]=a=>o.selectPaymentMethod("airtel")),class:G(["p-4 rounded-primea-lg border-2 transition-all text-center flex flex-col items-center justify-center min-h-[80px]",o.orderForm.paymentMethod==="airtel"?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300"])},[...e[43]||(e[43]=[t("img",{src:"/images/am.png",alt:"Airtel Money",class:"h-8 w-auto",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block'"},null,-1),t("div",{class:"text-red-600 font-bold text-sm",style:{display:"none"}},"airtel money",-1)])],2),t("button",{type:"button",onClick:e[8]||(e[8]=a=>o.selectPaymentMethod("moov")),class:G(["p-4 rounded-primea-lg border-2 transition-all text-center flex flex-col items-center justify-center min-h-[80px]",o.orderForm.paymentMethod==="moov"?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"])},[...e[44]||(e[44]=[t("img",{src:"/images/mm.png",alt:"Moov Money",class:"h-8 w-auto",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block'"},null,-1),t("div",{class:"bg-orange-500 text-white px-2 py-1 rounded text-xs font-bold",style:{display:"none"}},"Moov Money",-1)])],2),t("button",{type:"button",onClick:e[9]||(e[9]=a=>o.selectPaymentMethod("visa")),class:G(["p-4 rounded-primea-lg border-2 transition-all text-center flex flex-col items-center justify-center min-h-[80px]",o.orderForm.paymentMethod==="visa"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"])},[...e[45]||(e[45]=[t("img",{src:"/images/vm.png",alt:"Visa",class:"h-8 w-auto",onerror:"this.style.display='none'; this.nextElementSibling.style.display='block'"},null,-1),t("div",{class:"text-blue-600 font-bold text-sm",style:{display:"none"}},"VISA",-1)])],2)]),o.orderForm.paymentMethod==="airtel"||o.orderForm.paymentMethod==="moov"?(i(),l("div",Bt,[t("label",{for:`payment-${o.orderForm.paymentMethod}`,class:"block text-sm font-semibold text-primea-blue mb-2"}," Numéro "+c(o.orderForm.paymentMethod==="airtel"?"Airtel Money":"Moov Money"),9,zt),B(t("input",{id:`payment-${o.orderForm.paymentMethod}`,type:"tel","onUpdate:modelValue":e[10]||(e[10]=a=>o.orderForm.phoneNumber=a),placeholder:o.orderForm.paymentMethod==="airtel"?"074123456":"062123456",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-primea-lg focus:border-primea-blue focus:outline-none transition-colors font-primea",maxlength:9,pattern:"[0-9]{9}",required:"",onInput:e[11]||(e[11]=(...a)=>o.validatePhoneNumber&&o.validatePhoneNumber(...a))},null,40,Wt),[[H,o.orderForm.phoneNumber]]),o.phoneError?(i(),l("p",Jt,c(o.phoneError),1)):(i(),l("p",Kt,c(o.orderForm.paymentMethod==="airtel"?"Format: 074xxxxxx, 076xxxxxx ou 077xxxxxx":"Format: 060xxxxxx, 062xxxxxx, 065xxxxxx ou 066xxxxxx"),1))])):x("",!0),o.orderForm.paymentMethod==="visa"?(i(),l("div",Ht,[t("div",Gt,[e[48]||(e[48]=t("p",{class:"text-blue-800 mb-4 font-semibold"},"Paiement Visa sécurisé",-1)),e[49]||(e[49]=t("p",{class:"text-blue-600 text-sm mb-4"},"Vous allez être redirigé vers notre partenaire de paiement sécurisé",-1)),t("button",{type:"submit",disabled:o.loading||!o.isFormValid,class:"bg-blue-600 text-white px-6 py-3 rounded-primea-lg font-semibold hover:bg-blue-700 transition-all duration-200 flex items-center justify-center gap-2 mx-auto disabled:opacity-50 disabled:cursor-not-allowed"},[e[46]||(e[46]=t("img",{src:"/images/visa-logo.png",alt:"Visa",class:"h-6 w-auto",onerror:"this.style.display='none'"},null,-1)),e[47]||(e[47]=A(" Procéder au paiement Visa ",-1)),b(V,{class:"w-4 h-4"})],8,Qt),e[50]||(e[50]=t("p",{class:"text-xs text-gray-500 mt-2"},"Paiement 100% sécurisé avec chiffrement SSL",-1))])])):x("",!0)]),o.error?(i(),l("div",Xt,[t("p",Zt,c(o.error),1)])):x("",!0),o.ussdPushActive?(i(),l("div",Yt,[t("div",$t,[o.paymentStatus==="pending"?(i(),l("div",eo,[e[56]||(e[56]=t("div",{class:"flex items-center justify-center mb-4"},[t("div",{class:"w-16 h-16 border-4 border-blue-300 border-t-blue-600 rounded-full animate-spin"})],-1)),e[57]||(e[57]=t("h4",{class:"text-xl font-bold text-blue-800 mb-2"},"Push envoyé !",-1)),t("p",to,[e[52]||(e[52]=A(" Un push USSD a été envoyé au numéro ",-1)),t("span",oo,c(o.formatPhoneForDisplay(o.currentPayment?.phone)),1),e[53]||(e[53]=A(". Veuillez valider le paiement sur votre téléphone. ",-1))]),t("div",ro,[t("div",ao,c(o.formatCountdown(o.ussdCountdown)),1),e[54]||(e[54]=t("div",{class:"text-sm text-blue-500"},"Temps restant pour valider",-1)),t("div",no,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-1000",style:Ve({width:o.ussdCountdown/90*100+"%"})},null,4)])]),t("p",so,[e[55]||(e[55]=A(" Montant: ",-1)),t("span",lo,c(o.formatPrice(o.totalAmount))+" FCFA",1)]),t("div",io,[t("button",{onClick:e[12]||(e[12]=(...a)=>o.retryUSSDPush&&o.retryUSSDPush(...a)),disabled:o.loading||o.ussdCountdown>0,class:"bg-blue-600 text-white px-4 py-2 rounded-primea hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[o.loading?(i(),l("span",co,"Envoi...")):(i(),l("span",mo,"Renvoyer le push"))],8,uo),o.currentPayment.payment_url&&o.currentPayment.bill_id?(i(),l("button",{key:0,onClick:e[13]||(e[13]=(...a)=>o.payViaWebPage&&o.payViaWebPage(...a)),class:"bg-green-600 text-white px-4 py-2 rounded-primea hover:bg-green-700 transition-colors"}," Payer via page web ")):x("",!0),t("button",{onClick:e[14]||(e[14]=(...a)=>o.changeOperator&&o.changeOperator(...a)),disabled:o.ussdCountdown>0,class:"bg-gray-500 text-white px-4 py-2 rounded-primea hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Changer d'opérateur ",8,vo),t("button",{onClick:e[15]||(e[15]=(...a)=>o.cancelUSSDPush&&o.cancelUSSDPush(...a)),class:"bg-red-500 text-white px-4 py-2 rounded-primea hover:bg-red-600 transition-colors"}," Annuler ")])])):o.paymentStatus==="successful"?(i(),l("div",po,[...e[58]||(e[58]=[je('<div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4" data-v-525705b8><svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-525705b8><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-v-525705b8></path></svg></div><h4 class="text-xl font-bold text-green-800 mb-2" data-v-525705b8>Paiement réussi !</h4><p class="text-green-700 mb-4" data-v-525705b8>Votre paiement a été validé avec succès.</p><p class="text-green-600 text-sm" data-v-525705b8>Redirection en cours vers votre ticket...</p>',4)])])):o.paymentStatus==="failed"||o.paymentStatus==="cancelled"||o.paymentStatus==="expired"?(i(),l("div",bo,[e[59]||(e[59]=t("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},[t("svg",{class:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),e[60]||(e[60]=t("h4",{class:"text-xl font-bold text-red-800 mb-2"},"Paiement échoué",-1)),t("p",yo,c(o.paymentStatus==="cancelled"?"Le paiement a été annulé.":o.paymentStatus==="expired"?"Le délai de paiement a expiré.":"Le paiement a échoué. Veuillez réessayer."),1),t("div",go,[t("button",{onClick:e[16]||(e[16]=(...a)=>o.retryUSSDPush&&o.retryUSSDPush(...a)),class:"bg-blue-600 text-white px-4 py-2 rounded-primea hover:bg-blue-700 transition-colors"}," Réessayer "),t("button",{onClick:e[17]||(e[17]=(...a)=>o.changeOperator&&o.changeOperator(...a)),class:"bg-gray-500 text-white px-4 py-2 rounded-primea hover:bg-gray-600 transition-colors"}," Changer d'opérateur ")])])):x("",!0)])])):x("",!0),o.ussdPushActive?x("",!0):(i(),l("button",{key:4,type:"submit",disabled:o.loading||!o.isFormValid,class:"w-full bg-primea-blue text-white py-4 px-6 rounded-primea-lg text-lg font-bold hover:bg-primea-yellow hover:text-primea-blue transition-all duration-200 shadow-primea-lg transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",style:{"background-color":"#272d63"}},[o.loading?(i(),l("span",ho,[...e[61]||(e[61]=[t("svg",{class:"w-6 h-6 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24"},[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",class:"opacity-25"}),t("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",class:"opacity-75"})],-1),A(" Traitement en cours... ",-1)])])):(i(),l("span",fo,"Finaliser le paiement"))],8,xo)),t("div",wo,[b(S,{to:"/retrieve-ticket",class:"text-primea-blue hover:text-primea-yellow transition-colors"},{default:L(()=>[...e[62]||(e[62]=[A(" Récupérer mon ticket perdu ",-1)])]),_:1})])],32))])])):x("",!0)])])]),t("div",_o,[t("div",ko,[t("div",So,[t("button",{onClick:e[19]||(e[19]=(...a)=>o.goBack&&o.goBack(...a)),class:"text-gray-600 hover:text-gray-800"},[b(s,{class:"w-6 h-6"})]),b(S,{to:"/",class:"text-center"},{default:L(()=>[...e[63]||(e[63]=[t("img",{src:"/images/logo.png",alt:"Primea",class:"h-8 mx-auto mb-2 hover:opacity-80 transition-opacity"},null,-1),t("div",{class:"text-right"},[t("div",{class:"text-lg font-bold text-blue-600"},"La Billetterie"),t("div",{class:"text-xs text-gray-500"},"Simple, Rapide et Sécurisée")],-1)])]),_:1}),t("button",Po,[b(D,{class:"w-6 h-6"})])]),e[64]||(e[64]=t("div",{class:"text-center text-gray-500 py-8"}," Version mobile en cours de développement ",-1))])])])}const Ao=Be(Je,[["render",Eo],["__scopeId","data-v-525705b8"]]);export{Ao as default};
