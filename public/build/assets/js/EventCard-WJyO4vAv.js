import{H as R,J as U,r as L,c as f,b as l,i as b,d as s,e as a,g as k,q as E,t as c,j as D,A as y,N as S}from"./vue-vendor-wiowK_YT.js";import{_ as B,C as F}from"./account-CYVf-4X6.js";const p={name:"EventCard",components:{CalendarIcon:F,ClockIcon:U,MapPinIcon:R},props:{event:{type:Object,required:!0}},setup(n){const r=S(),i=L(!1),t=f(()=>{if(i.value)return null;let e=n.event.image||n.event.image_url||n.event.image_file;if(console.log("EventCard - Image URL pour:",n.event.title,"Image:",e),!e||e.trim()==="")return console.log("EventCard - Aucune image trouvée"),null;if(e.startsWith("http://")||e.startsWith("https://"))return console.log("EventCard - URL complète détectée:",e),e;if(e.startsWith("/")){const o=window.location.origin+e;return console.log("EventCard - Chemin relatif converti:",o),o}if(!e.includes("/")){const o=`${window.location.origin}/storage/images/events/${e}`;return console.log("EventCard - Nom de fichier converti:",o),o}return console.log("EventCard - URL retournée telle quelle:",e),e}),_=f(()=>{let e=null;if(n.event.schedules&&n.event.schedules.length>0&&(e=n.event.schedules[0].starts_at),!e&&n.event.next_schedule&&(e=n.event.next_schedule.starts_at),!e)return null;try{let o;if(e.includes("T")||e.includes("Z"))o=new Date(e);else if(e.includes("/")){const[m,v]=e.split(" "),[u,w,C]=m.split("/");o=new Date(`${C}-${w.padStart(2,"0")}-${u.padStart(2,"0")}T${v||"00:00:00"}`)}else if(e.includes("-")){const m=e.replace(" ","T");o=new Date(m)}else o=new Date(e);return isNaN(o.getTime())?(console.warn("Date invalide pour l'événement:",n.event.title,"Date reçue:",e),null):o}catch(o){return console.error("Erreur lors du parsing de la date:",o,"Date reçue:",e),null}}),T=f(()=>{if(n.event.min_price!==void 0&&n.event.min_price!==null&&n.event.min_price>0)return n.event.min_price;const e=n.event.ticket_types||n.event.ticketTypes;if(e&&e.length>0){const o=e.map(m=>{const v=parseFloat(m.price);return isNaN(v)?0:v}).filter(m=>m>0);if(o.length>0)return Math.min(...o)}return 0}),g=f(()=>_.value?new Date>_.value:!1),h=f(()=>{if(g.value)return 0;const e=n.event.ticket_types||n.event.ticketTypes;if(e&&e.length>0){const o=e.reduce((v,u)=>{if(u.remaining_quantity!==void 0&&u.remaining_quantity!==null)return v+Math.max(0,u.remaining_quantity);if(u.available_quantity!==void 0&&u.available_quantity!==null){const N=u.sold_quantity||0;return v+Math.max(0,u.available_quantity-N)}const w=u.quantity||0,C=u.sold_quantity||u.sold||0;return v+Math.max(0,w-C)},0);return e.some(v=>v.available_quantity!==null&&v.available_quantity!==void 0)?o:1e3}return 1e3}),x=f(()=>g.value?"Événement passé":h.value===0?"Complet":"Acheter un ticket"),d=f(()=>!g.value&&h.value>0),P=e=>e?e.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"Date à confirmer",q=e=>e?e.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"--:--",M=e=>new Intl.NumberFormat("fr-FR").format(e),j=(e,o)=>!e||typeof e!="string"?"":e.length<=o?e:e.substr(0,o).trim()+"...",z=()=>{r.push(`/events/${n.event.slug}`)},I=()=>{console.log("goToCheckout called with event:",n.event),console.log("Event slug:",n.event.slug);let e=n.event.slug;if(!e)if(n.event.id)e={1:"concert-jazz-etoiles",2:"oiseau-rare",3:"festival-arts-culture"}[n.event.id]||`event-${n.event.id}`;else if(n.event.title)e=n.event.title.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-").slice(0,50);else{console.error("Event slug, ID and title are all missing!",n.event),alert("Erreur: Impossible de réserver - informations manquantes");return}console.log("Using slug:",e),r.push(`/checkout/${e}`)};return{eventImageUrl:t,eventDate:_,minPrice:T,isEventPassed:g,availableTickets:h,buttonText:x,canPurchase:d,formatDate:P,formatTime:q,formatPrice:M,truncateText:j,goToEvent:z,goToCheckout:I,handleReserveClick:e=>{if(console.log("handleReserveClick called"),e.preventDefault(),e.stopPropagation(),!d.value){console.log("Cannot purchase - button disabled");return}I()},handleImageError:e=>{console.warn("EventCard - Erreur de chargement image pour:",n.event.title),console.warn("EventCard - URL qui a échoué:",e?.target?.src),i.value=!0}}}},V={class:"event-image"},A=["src","alt"],W={key:1,class:"w-full h-full bg-gradient-to-br from-blue-100 to-yellow-100 flex items-center justify-center"},H={key:2,class:"absolute top-4 left-4"},Q={class:"bg-yellow-400 primea-text-blue px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide"},G={class:"absolute bottom-4 left-4 right-4 flex items-end justify-between"},J={class:"bg-black/70 backdrop-blur-sm rounded-lg px-3 py-2 text-white"},O={key:0},Z={class:"text-lg font-bold"},K={key:1,class:"text-lg font-bold text-green-400"},X={class:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center pointer-events-none"},Y={class:"p-6"},$={class:"flex flex-wrap items-center gap-2 md:gap-4 mb-3 text-sm text-gray-500"},ee={class:"flex items-center gap-1 whitespace-nowrap"},te={class:"flex items-center gap-1 whitespace-nowrap"},ne={class:"font-bold text-xl primea-text-blue mb-2 line-clamp-2"},ae={class:"flex items-center gap-1 mb-3 text-gray-600"},oe={key:0},re={key:1},ie={key:2},le={class:"text-gray-600 text-sm mb-4 line-clamp-3"},se={class:"flex items-center justify-between"},ce={key:0,class:"text-gray-500 text-sm font-medium flex items-center gap-1"},de={key:1,class:"text-amber-600 text-sm font-medium flex items-center gap-1"},ue={key:2,class:"text-red-600 text-sm font-medium"};function ve(n,r,i,t,_,T){const g=E("CalendarIcon"),h=E("ClockIcon"),x=E("MapPinIcon");return i.event&&i.event.title?(s(),l("article",{key:0,class:"event-card-modern group cursor-pointer",onClick:r[4]||(r[4]=(...d)=>t.goToEvent&&t.goToEvent(...d))},[a("div",V,[t.eventImageUrl?(s(),l("img",{key:0,src:t.eventImageUrl,alt:i.event.title,loading:"lazy",class:"w-full h-full object-cover",onError:r[0]||(r[0]=(...d)=>t.handleImageError&&t.handleImageError(...d))},null,40,A)):(s(),l("div",W,[k(g,{size:"2xl",class:"primea-text-gray-400"})])),i.event.category?.name||i.event.category_name?(s(),l("div",H,[a("span",Q,c(i.event.category?.name||i.event.category_name||"Événement"),1)])):b("",!0),a("div",G,[a("div",J,[t.minPrice>0?(s(),l("div",O,[r[5]||(r[5]=a("div",{class:"text-xs text-gray-300"},"À partir de",-1)),a("div",Z,c(t.formatPrice(t.minPrice))+" FCFA",1)])):(s(),l("div",K,"Gratuit"))]),t.canPurchase?(s(),l("button",{key:0,onClick:r[1]||(r[1]=D((...d)=>t.goToCheckout&&t.goToCheckout(...d),["stop"])),class:"ticket-btn-animate bg-yellow-500 text-blue-950 px-4 py-2 rounded-lg text-sm font-bold hover:bg-yellow-400 transition-all flex items-center gap-1 shadow-lg hover:shadow-xl"},[...r[6]||(r[6]=[a("svg",{class:"w-4 h-4 ticket-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})],-1),y(" Prendre un ticket ",-1)])])):b("",!0)]),a("div",X,[a("button",{onClick:r[2]||(r[2]=D((...d)=>t.goToEvent&&t.goToEvent(...d),["stop"])),class:"bg-primea-yellow text-primea-blue px-6 py-3 rounded-primea-lg font-bold hover:bg-white hover:text-primea-blue transition-all duration-200 shadow-primea-lg transform translate-y-4 group-hover:translate-y-0 flex items-center pointer-events-auto"},[...r[7]||(r[7]=[a("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),y(" Voir détails ",-1)])])])]),a("div",Y,[a("div",$,[a("div",ee,[k(g,{size:"sm"}),a("span",null,c(t.formatDate(t.eventDate)),1)]),a("div",te,[k(h,{class:"w-4 h-4"}),a("span",null,c(t.formatTime(t.eventDate)),1)])]),a("h3",ne,[a("button",{onClick:r[3]||(r[3]=(...d)=>t.goToEvent&&t.goToEvent(...d)),class:"hover:underline text-left"},c(i.event.title),1)]),a("div",ae,[k(x,{class:"w-4 h-4"}),i.event.venue?(s(),l("span",oe,c(i.event.venue.name)+", "+c(i.event.venue.city),1)):i.event.venue_name?(s(),l("span",re,c(i.event.venue_name)+", "+c(i.event.venue_city),1)):(s(),l("span",ie,"Lieu à confirmer"))]),a("p",le,c(t.truncateText(i.event.description,120)),1),a("div",se,[a("div",null,[t.isEventPassed?(s(),l("div",ce,[...r[8]||(r[8]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),y(" Événement terminé ",-1)])])):t.availableTickets<20&&t.availableTickets>0?(s(),l("div",de,[r[9]||(r[9]=a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),y(" "+c(t.availableTickets)+" place"+c(t.availableTickets>1?"s":"")+" restante"+c(t.availableTickets>1?"s":""),1)])):t.availableTickets===0&&!t.isEventPassed?(s(),l("div",ue,"Complet")):b("",!0)])])])])):b("",!0)}const _e=B(p,[["render",ve],["__scopeId","data-v-315b80aa"]]);export{_e as E};
